<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/notas-de-aprendizaje/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/notas-de-aprendizaje/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/notas-de-aprendizaje/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/notas-de-aprendizaje/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Effective Java | Notes</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Effective Java" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Keyvan Akbary learning notes" /> <meta property="og:description" content="Keyvan Akbary learning notes" /> <meta property="og:site_name" content="Notes" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Effective Java" /> <script type="application/ld+json"> {"@type":"WebPage","description":"Keyvan Akbary learning notes","url":"/notas-de-aprendizaje/books/effective-java/","headline":"Effective Java","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/notas-de-aprendizaje/" class="site-title lh-tight"> Notes </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/notas-de-aprendizaje/articles/" class="nav-list-link">Articles</a><ul class="nav-list "></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/notas-de-aprendizaje/books/" class="nav-list-link">Books</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/notas-de-aprendizaje/talks/" class="nav-list-link">Talks</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/notas-de-aprendizaje/papers/" class="nav-list-link">Papers</a><ul class="nav-list "></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Notes" aria-label="Search Notes" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/sanrm/notas-de-aprendizaje" class="site-button" > Notas de aprendizaje en GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/notas-de-aprendizaje/books/">Books</a></li> <li class="breadcrumb-nav-list-item"><span>Effective Java</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="effective-java"> <a href="#effective-java" class="anchor-heading" aria-labelledby="effective-java"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://www.goodreads.com/book/show/105099.Effective_Java_Programming_Language_Guide">Effective Java</a> </h1> <ul> <li><a href="#creating-and-destroying-objects">Creating and destroying objects</a></li> <li><a href="#methods-common-to-all-objects">Methods common to all objects</a></li> <li><a href="#classes-and-interfaces">Classes and interfaces</a></li> <li><a href="#generics">Generics</a></li> <li><a href="#enums-and-annotations">Enums and annotations</a></li> <li><a href="#lambdas-and-streams">Lambdas and streams</a></li> <li><a href="#methods">Methods</a></li> <li><a href="#general-programming">General programming</a></li> <li><a href="#exceptions">Exceptions</a></li> <li><a href="#concurrency">Concurrency</a></li> <li><a href="#serialisation">Serialisation</a></li> </ul> <h2 id="creating-and-destroying-objects"> <a href="#creating-and-destroying-objects" class="anchor-heading" aria-labelledby="creating-and-destroying-objects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating and destroying objects </h2> <h3 id="consider-static-factory-methods-instead-of-constructors"> <a href="#consider-static-factory-methods-instead-of-constructors" class="anchor-heading" aria-labelledby="consider-static-factory-methods-instead-of-constructors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consider static factory methods instead of constructors </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">Boolean</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">b</span> <span class="o">?</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">TRUE</span> <span class="o">:</span> <span class="nc">Boolean</span><span class="o">.</span><span class="na">FALSE</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Advantages:</p> <ul> <li>They have names.</li> <li>They are not required to create a new object each time they are invoked.</li> <li>They can return an object of any subtype of their return type.</li> <li>The class of the returned object can vary from call to call as a function of the input parameters.</li> <li>The class of the returned object need to exist when the class containing the method is written.</li> </ul> <p>Disadvantages:</p> <ul> <li>Classes that provide only static factory methods without public or protected constructors cannot be subclassed. This is preferable when using composition instead of inheritance.</li> <li>They are hard for programmers to find. Some conventions <ul> <li><code class="language-plaintext highlighter-rouge">from</code>, as type-conversion method <code class="language-plaintext highlighter-rouge">Date d = Date.from(instant)</code></li> <li><code class="language-plaintext highlighter-rouge">of</code>, an aggregation method <code class="language-plaintext highlighter-rouge">Set&lt;Rank&gt; faceCards = EnumSet.of(JACK, QUEEN, KING)</code></li> <li><code class="language-plaintext highlighter-rouge">valueOf</code>, more verbose alternative than <code class="language-plaintext highlighter-rouge">from</code> and <code class="language-plaintext highlighter-rouge">of</code>, <code class="language-plaintext highlighter-rouge">BigInteger prime = BigInteger.valueOf(Integer.MAX_VALUE)</code></li> <li><code class="language-plaintext highlighter-rouge">instance</code> or <code class="language-plaintext highlighter-rouge">getInstance</code>, returns and instance that cannot be said to have the same values, <code class="language-plaintext highlighter-rouge">StackWalker luke = StackWalker.getInstance(options)</code></li> <li><code class="language-plaintext highlighter-rouge">create</code> or <code class="language-plaintext highlighter-rouge">newInstance</code> the method guarantees each call returns a new instance, <code class="language-plaintext highlighter-rouge">Object newArray = Array.newInstance(classObject, arrayLength)</code></li> <li><code class="language-plaintext highlighter-rouge">get</code><strong>Type</strong>, like <code class="language-plaintext highlighter-rouge">getInstance</code>but when factory method is in a different class <code class="language-plaintext highlighter-rouge">FileStore fs = Files.getFileStore(path)</code></li> <li><code class="language-plaintext highlighter-rouge">new</code><strong>Type</strong>, like <code class="language-plaintext highlighter-rouge">newInstance</code> but when factory method is in a different class <code class="language-plaintext highlighter-rouge">BufferedReader br = Files.newBufferedReader(path)</code></li> <li><strong>type</strong>, a concise alternative to <code class="language-plaintext highlighter-rouge">get</code><em>Type</em> and <code class="language-plaintext highlighter-rouge">new</code><em>Type</em>, <code class="language-plaintext highlighter-rouge">List&lt;Compliant&gt; litany = Collections.list(legacyLitany)</code></li> </ul> </li> </ul> <h3 id="consider-builder-when-faced-with-many-constructor-parameters"> <a href="#consider-builder-when-faced-with-many-constructor-parameters" class="anchor-heading" aria-labelledby="consider-builder-when-faced-with-many-constructor-parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consider builder when faced with many constructor parameters </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>  <span class="c1">// (mL)            required</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>     <span class="c1">// (per container) required</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>     <span class="c1">// (per serving)   optional</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>          <span class="c1">// (g/serving)     optional</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span>       <span class="c1">// (mg/serving)    optional</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span> <span class="c1">// (g/serving)     optional</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="n">calories</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">,</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="n">calories</span><span class="o">,</span> <span class="n">fat</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">,</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="n">calories</span><span class="o">,</span> <span class="n">fat</span><span class="o">,</span> <span class="n">sodium</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">,</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">,</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span>  <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">servings</span>     <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">calories</span>     <span class="o">=</span> <span class="n">calories</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fat</span>          <span class="o">=</span> <span class="n">fat</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sodium</span>       <span class="o">=</span> <span class="n">sodium</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">carbohydrate</span> <span class="o">=</span> <span class="n">carbohydrate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>The telescoping constructor pattern works, but it is hard to write client code when there are many parameters, and harder still to read it.</p> <p>Avoid using JavaBeans pattern as it might leave the object in an inconsistent state partway through its construction. It does also precludes the possibility of making the class immutable.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>

        <span class="kd">private</span> <span class="kt">int</span> <span class="n">calories</span>      <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">fat</span>           <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">sodium</span>        <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">carbohydrate</span>  <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">servings</span>    <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">calories</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
            <span class="o">{</span> <span class="n">calories</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>      <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">fat</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
            <span class="o">{</span> <span class="n">fat</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>           <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">sodium</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
            <span class="o">{</span> <span class="n">sodium</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>        <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>
        <span class="kd">public</span> <span class="nc">Builder</span> <span class="nf">carbohydrate</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span>
            <span class="o">{</span> <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>  <span class="k">return</span> <span class="k">this</span><span class="o">;</span> <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">NutritionFacts</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="nc">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">servingSize</span>  <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servingSize</span><span class="o">;</span>
        <span class="n">servings</span>     <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servings</span><span class="o">;</span>
        <span class="n">calories</span>     <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">calories</span><span class="o">;</span>
        <span class="n">fat</span>          <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">fat</span><span class="o">;</span>
        <span class="n">sodium</span>       <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">sodium</span><span class="o">;</span>
        <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">carbohydrate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">NutritionFacts</span> <span class="n">cocaCola</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NutritionFacts</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="mi">240</span><span class="o">,</span> <span class="mi">8</span><span class="o">)</span>
    <span class="o">.</span><span class="na">calories</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">sodium</span><span class="o">(</span><span class="mi">35</span><span class="o">).</span><span class="na">carbohydrate</span><span class="o">(</span><span class="mi">27</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div> <p>The Builder pattern simulates named optional parameters and it is well suited to class hierarchies. <strong>It is good choice when designing classes whose constructors or static factories would have more than a handful of parameters.</strong></p> <h3 id="enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type"> <a href="#enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type" class="anchor-heading" aria-labelledby="enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enforce the singleton property with a private constructor or an enum type </h3> <p>Beware that making a class a singleton can make it difficult to test its clients because it’s impossible to substitute a mock implementation /</p> <p><strong>Singleton with public final field</strong>, this approach is simpler and it makes it clear that the class is a singleton.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Elvis</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Elvis</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Elvis</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nf">Elvis</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Singleton with static factory</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Elvis</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Elvis</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Elvis</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nf">Elvis</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Elvis</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Enum singleton</strong>, similar to public field approach but more concise. It provides serialisation machinery for free and provides guarantee against multiple instantiation even on serialisation and reflection attacks. <strong>This is the best way of implementing a singleton.</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Elvis</span> <span class="o">{</span>
    <span class="no">INSTANCE</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="enforce-noninstantiability-with-a-private-constructor"> <a href="#enforce-noninstantiability-with-a-private-constructor" class="anchor-heading" aria-labelledby="enforce-noninstantiability-with-a-private-constructor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enforce noninstantiability with a private constructor </h3> <p>Ocassionally you’ll want to write a class that is a grouping of static methods. People abuse them in order to avoid thinking in terms of objects, but they have valud use cases.</p> <p>Such <em>utility clases</em> are not designed to be instantiated.</p> <p>Attempting to enforce noninstantiability by making the class abstract does not work. <strong>A class can be made noninstantiable by including a private constructor.</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UtilityClass</span> <span class="o">{</span>
    <span class="c1">// Suppress default constructor for noninstantiability</span>
    <span class="kd">private</span> <span class="nf">UtilityClass</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="c1">// Remainder omitted</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="prefer-dependency-injection-to-hardwiring-resources"> <a href="#prefer-dependency-injection-to-hardwiring-resources" class="anchor-heading" aria-labelledby="prefer-dependency-injection-to-hardwiring-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer dependency injection to hardwiring resources </h3> <p>Innapropiate use of static utility, inflexible and untestable.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpellChecker</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Lexicon</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="o">...;</span>

    <span class="kd">private</span> <span class="nf">SpellChecker</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// Noninstantiable</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">suggestions</span><span class="o">(</span><span class="nc">String</span> <span class="n">typo</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Dependency injection provides flexibility and testability</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpellChecker</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Lexicon</span> <span class="n">dictionary</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SpellChecker</span><span class="o">(</span><span class="nc">Lexicon</span> <span class="n">dictionary</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dictionary</span> <span class="o">=</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">dictionary</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">suggestions</span><span class="o">(</span><span class="nc">String</span> <span class="n">typo</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>A useful variant of the pattern is to pass a resource <em>factory</em> to the constructor so the object can be called repeatedly to create instance of a type.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Mosaic</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Supplier</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Tile</span><span class="o">&gt;</span> <span class="n">tileFactory</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div> <h3 id="avoid-creating-unnecessary-objects"> <a href="#avoid-creating-unnecessary-objects" class="anchor-heading" aria-labelledby="avoid-creating-unnecessary-objects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Avoid creating unnecessary objects </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"bikini"</span><span class="o">);</span>
</code></pre></div></div> <p>Performance can be greatly improved</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isRomanNumeral</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">"^(?=.)M*(C[MD]|D?C{0,3})"</span>
        <span class="o">+</span> <span class="s">"(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Reusing expensive object for improved performance</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RomanNumerals</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Pattern</span> <span class="no">ROMAN</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span>
        <span class="s">"^(?=.)M*(C[MD]|D?C{0,3})"</span> <span class="o">+</span>
        <span class="s">"(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$"</span><span class="o">);</span>

    <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isRomanNumeral</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">ROMAN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="na">matches</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Be careful with autoboxing, as it blurs the distinction betwen primitive and boxed primitive types. The following code is hideously slow, can you spot object creation?</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">sum</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Long</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="o">;</span>

    <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Prefer primitives to boxed primitives, and watch out for unintentional autoboxing.</p> <h3 id="eliminate-obsolete-object-references"> <a href="#eliminate-obsolete-object-references" class="anchor-heading" aria-labelledby="eliminate-obsolete-object-references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Eliminate obsolete object references </h3> <p>Can you find the <em>memory leak</em>?</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="mi">16</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[</span><span class="no">DEFAULT_INITIAL_CAPACITY</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="nc">Object</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureCapacity</span><span class="o">();</span>
        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Ensure space for at least one more element, roughly
     * doubling the capacity each time the array needs to grow.
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span>
            <span class="n">elements</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Don’t forget to null out references once they become obsolete!</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">EmptyStackException</span><span class="o">();</span>

    <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
    <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// Eliminate obsolete reference</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div> <p>Be mindful about this, <strong>nulling out object references should be the exception rather than the norm.</strong> The best way to eliminate an obsolete reference is to let the variable that contained the reference fall out of scope.</p> <p>Whenever a class manages its own memory, the programmer should be alert for memory leaks.</p> <p>Common sources of memory leaks are caches, listeners and callbacks.</p> <h3 id="avoid-finalisers-and-cleaners"> <a href="#avoid-finalisers-and-cleaners" class="anchor-heading" aria-labelledby="avoid-finalisers-and-cleaners"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Avoid finalisers and cleaners </h3> <p>Finalisers are unpredictable, often dangerous, and generally unnecessary. Cleaners are less dangerous than finalisers, but still unpredictable, slow, and generally unnecessary.</p> <p>Never do anything time-critical in a finalisers or cleaners. There is no guarantee they’ll be executed promptly.</p> <p>Never depend on a finaliser or cleaner to update persistent state. The language specification provides no guarantee that finalisers or cleaners will run at all.</p> <p>There is a sever performance penalty for using finalisers and cleaners.</p> <p>Finalisers have a serious security problem: they open your class up to finaliser attacks. Throwing an exception from a constructor should be sufficient to prevent an object form coming into existence; in the presence of finalisers, it is not. To protect nonfinal classes from finaliser attacks, write a final <code class="language-plaintext highlighter-rouge">finalize</code> method that does nothing.</p> <p>Instead of writing a finaliser or cleaner, just have your class implement <code class="language-plaintext highlighter-rouge">AutoCloseable</code>.</p> <h3 id="prefer-try-with-resources-to-try-finally"> <a href="#prefer-try-with-resources-to-try-finally" class="anchor-heading" aria-labelledby="prefer-try-with-resources-to-try-finally"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer <code class="language-plaintext highlighter-rouge">try</code>-with-resources to <code class="language-plaintext highlighter-rouge">try-finally</code> </h3> <p><code class="language-plaintext highlighter-rouge">try-finally</code> is no longer the best way to close resources.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">String</span> <span class="nf">firstLineOfFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="n">path</span><span class="o">));</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">try-finally</code> is ugly when used with more than one resource.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">void</span> <span class="nf">copy</span><span class="o">(</span><span class="nc">String</span> <span class="n">src</span><span class="o">,</span> <span class="nc">String</span> <span class="n">dst</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="nc">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">dst</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="no">BUFFER_SIZE</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
                <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">try</code>-with-resources is the best way to close resources.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>static String firstLineOfFile(String path) throws IOException {
    try (BufferedReader br = new BufferedReader(new FileReader(path))) {
       return br.readLine();
    }
}
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">try</code>-with-resources on multiple resources, short and sweet.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>static void copy(String src, String dst) throws IOException {
    try (InputStream   in = new FileInputStream(src);
         OutputStream out = new FileOutputStream(dst)) {
        byte[] buf = new byte[BUFFER_SIZE];
        int n;
        while ((n = in.read(buf)) &gt;= 0)
            out.write(buf, 0, n);
    }
}
</code></pre></div></div> <h2 id="methods-common-to-all-objects"> <a href="#methods-common-to-all-objects" class="anchor-heading" aria-labelledby="methods-common-to-all-objects"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Methods common to all objects </h2> <h3 id="obey-the-general-contract-when-overriding-equals"> <a href="#obey-the-general-contract-when-overriding-equals" class="anchor-heading" aria-labelledby="obey-the-general-contract-when-overriding-equals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Obey the general contract when overriding <code class="language-plaintext highlighter-rouge">equals</code> </h3> <ul> <li>Each instance of the class is inherently unique</li> <li>there is no need for the class to provide a “logical equality” test</li> <li>A superclass has overriden <code class="language-plaintext highlighter-rouge">equals</code>, and the superclass behaviour is appropiate for this class</li> <li>The class is private or package-private, and you are certain that its <code class="language-plaintext highlighter-rouge">equals</code> method will never be invoked.</li> </ul> <p><code class="language-plaintext highlighter-rouge">equals</code> method implements <em>equivalence relation</em> for any non-null reference values:</p> <ul> <li><strong>Reflexive</strong>: <code class="language-plaintext highlighter-rouge">x.equals(x)</code> must return <code class="language-plaintext highlighter-rouge">true</code></li> <li><strong>Symmetric</strong>: <code class="language-plaintext highlighter-rouge">x.equals(y)</code> returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">y.equals(x)</code> returns <code class="language-plaintext highlighter-rouge">true</code></li> <li><strong>Transitive</strong>: <code class="language-plaintext highlighter-rouge">x.equals(y)</code> returns <code class="language-plaintext highlighter-rouge">true</code> and <code class="language-plaintext highlighter-rouge">y.equals(z)</code> returns <code class="language-plaintext highlighter-rouge">true</code>, then <code class="language-plaintext highlighter-rouge">x.equals(z)</code> must return <code class="language-plaintext highlighter-rouge">true</code></li> <li><strong>Consistent</strong>: <code class="language-plaintext highlighter-rouge">x.equals(y)</code> should consistently return <code class="language-plaintext highlighter-rouge">true</code> or consistently return <code class="language-plaintext highlighter-rouge">false</code></li> <li><code class="language-plaintext highlighter-rouge">x.equals(null)</code> must return <code class="language-plaintext highlighter-rouge">false</code></li> </ul> <p>Do not write an <code class="language-plaintext highlighter-rouge">equals</code> method that depends on unreliable resources.</p> <p>All objects objects must be unequal to <code class="language-plaintext highlighter-rouge">null</code>.</p> <p>A few more caveats:</p> <ul> <li>Always override <code class="language-plaintext highlighter-rouge">hashCode</code> when you override <code class="language-plaintext highlighter-rouge">equals</code>.</li> <li>Don’t try to be too clever</li> <li>Don’t substitute another type for <code class="language-plaintext highlighter-rouge">Object</code> in the <code class="language-plaintext highlighter-rouge">equals</code> declaration.</li> </ul> <h3 id="always-override-hashcode-when-you-override-equals"> <a href="#always-override-hashcode-when-you-override-equals" class="anchor-heading" aria-labelledby="always-override-hashcode-when-you-override-equals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Always override <code class="language-plaintext highlighter-rouge">hashCode</code> when you override equals </h3> <p>Equal objects must have equal hash codes.</p> <p>Do not be tempted to exclude significant fields from the hash code computation to improve performance.</p> <p>Don’t provide a detailed specification for the value returned by <code class="language-plaintext highlighter-rouge">hashCode</code>, so clients can’t reasonably depend on it; this gives you the flexibility to change it.</p> <h3 id="always-override-tostring"> <a href="#always-override-tostring" class="anchor-heading" aria-labelledby="always-override-tostring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Always override <code class="language-plaintext highlighter-rouge">toString</code> </h3> <p>Providing a good <code class="language-plaintext highlighter-rouge">toString</code> implementation makes your class much more pleasant to use and makes systems using the class easier to debug.</p> <p>When practical, the <code class="language-plaintext highlighter-rouge">toString</code> method should return all the interesting information in the object.</p> <p>Whether or not you decide to specify the format, you should clearly document your intentions.</p> <h3 id="override-clone-judiciously"> <a href="#override-clone-judiciously" class="anchor-heading" aria-labelledby="override-clone-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Override <code class="language-plaintext highlighter-rouge">clone</code> judiciously </h3> <p>In practice, a class implementing <code class="language-plaintext highlighter-rouge">Cloneable</code> is expected to provide a properly functioning public <code class="language-plaintext highlighter-rouge">clone</code> method.</p> <p>Immutable classes should never provide a <code class="language-plaintext highlighter-rouge">clone</code> method, because that would only encourage wasteful copying.</p> <p>The <code class="language-plaintext highlighter-rouge">clone</code> method functions as a constructor; you must ensure that it does no harm to the original object and that it properly establishes invariants on the clone.</p> <p>The <code class="language-plaintext highlighter-rouge">Cloneable</code> architecture is incompatible with normal use of final fields referring to mutable objects.</p> <p>Public <code class="language-plaintext highlighter-rouge">clone</code> methods should omit the <code class="language-plaintext highlighter-rouge">throws</code> clause, as methods that don’t throw checked exceptions are easier to use.</p> <p>A better approach to object copying is to provide a copy constructor or copy factory.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">Yum</span><span class="o">(</span><span class="nc">Yum</span> <span class="n">yum</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="nc">Yum</span> <span class="nf">newInstance</span><span class="o">(</span><span class="nc">Yum</span> <span class="n">yum</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">};</span>
</code></pre></div></div> <p>Advantages of using copy constructor or copy factory:</p> <ul> <li>They don’t rely on a risk-prone extralinguistic object creation mechanism.</li> <li>They don’t demand unenforceable adherence to thinly documented conventions.</li> <li>They don’t conflict with the proper use of final fields.</li> <li>They don’t throw unnecessary checked exceptions.</li> <li>They don’t require casts.</li> <li>They can take an argument whose type is an interface implemented by the class.</li> <li>Interface-based copy constructors and factories (<em>conversion</em> constructors and <em>conversion</em> factories) allow the client to accept the implementation type of the original.</li> </ul> <h3 id="consider-implementing-comparable"> <a href="#consider-implementing-comparable" class="anchor-heading" aria-labelledby="consider-implementing-comparable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consider implementing <code class="language-plaintext highlighter-rouge">Comparable</code> </h3> <p>The notation <code class="language-plaintext highlighter-rouge">sgn</code>(expression) designates the mathematical <em>signum</em> function, which is defined to return -1, 0, or 1</p> <ul> <li>The implementor must ensure that <code class="language-plaintext highlighter-rouge">sgn(x.compareTo(y)) == -sgn(y. compareTo(x))</code> for all <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code>. Implies that <code class="language-plaintext highlighter-rouge">x.compareTo(y)</code> must throw an exception if and only if <code class="language-plaintext highlighter-rouge">y.compareTo(x)</code> throws an exception.</li> <li>Transitive: <code class="language-plaintext highlighter-rouge">(x. compareTo(y) &gt; 0 &amp;&amp; y.compareTo(z) &gt; 0)</code> implies <code class="language-plaintext highlighter-rouge">x.compareTo(z) &gt; 0</code>.</li> <li><code class="language-plaintext highlighter-rouge">x.compareTo(y) == 0</code> implies that <code class="language-plaintext highlighter-rouge">sgn(x.compareTo(z)) == sgn(y.compareTo(z))</code>, for all <code class="language-plaintext highlighter-rouge">z</code>.</li> <li>It is strongly recommended, but not required, that <code class="language-plaintext highlighter-rouge">(x.compareTo(y) == 0) == (x.equals(y))</code>.</li> </ul> <p>Use of the relational operators <code class="language-plaintext highlighter-rouge">&lt;</code> and <code class="language-plaintext highlighter-rouge">&gt;</code> in compareTo methods is verbose and error-prone and no longer recommended.</p> <p>If a class has multiple significant fields, the order in which you compare them is critical. Start with the most significant field and work your way down.</p> <p>The <code class="language-plaintext highlighter-rouge">Comparator</code> interface is outfitted with a set of comparator construction methods, which enable fluent construction of comparators. Many programmers prefer the conciseness of this approach, though it does come at a modest performance cost.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">PhoneNumber</span><span class="o">&gt;</span> <span class="no">COMPARATOR</span> <span class="o">=</span>
    <span class="n">comparingInt</span><span class="o">((</span><span class="nc">PhoneNumber</span> <span class="n">pn</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="na">areaCode</span><span class="o">)</span>
        <span class="o">.</span><span class="na">thenComparingInt</span><span class="o">(</span><span class="n">pn</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="na">prefix</span><span class="o">)</span>
        <span class="o">.</span><span class="na">thenComparingInt</span><span class="o">(</span><span class="n">pn</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="na">lineNum</span><span class="o">);</span>

<span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">PhoneNumber</span> <span class="n">pn</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="no">COMPARATOR</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">pn</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Avoid comparators based on differences, they violate transitivity</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">hashCodeOrder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Comparator</span><span class="o">&lt;&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">};</span>
</code></pre></div></div> <h2 id="classes-and-interfaces"> <a href="#classes-and-interfaces" class="anchor-heading" aria-labelledby="classes-and-interfaces"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Classes and interfaces </h2> <h3 id="minimise-the-accessibility-of-classes-and-members"> <a href="#minimise-the-accessibility-of-classes-and-members" class="anchor-heading" aria-labelledby="minimise-the-accessibility-of-classes-and-members"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Minimise the accessibility of classes and members </h3> <p>A well-designed component hides all its implementation details, cleanly separating their API from its implementation.</p> <p>Information hiding or <em>encapsulation</em> is important because:</p> <ul> <li><em>Decouples</em> the component that comprise the system, allowing them to be developed, tested, optimised, used, understood and modified in isolation.</li> <li>Speeds up development because components can be developed in parallel.</li> <li>Eases the burden of maintenance because components can be understood more quickly and debugged or replaced with little fear or harming other components.</li> <li>Components can be optimised without affecting correctness of others.</li> <li>Increases software reuse because components that aren’t tightly coupled often prove useful in other contexts.</li> <li>Decreases the risk in building large systems because individual components may prove successful even if the system does not.</li> </ul> <p>Make each class or member as inaccessible as possible.</p> <p>Instance fields of public classes should rarely be public. Classes with public mutable fields are generally thread-safe.</p> <p>Nonzero-length array is always mutable, so it is wrong for a class to have a public static final array field, or accessor that returns such a field. It is a potential security hole.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Thing</span><span class="o">[]</span> <span class="no">VALUES</span> <span class="o">=</span> <span class="o">{</span> <span class="o">...</span> <span class="o">};</span>
</code></pre></div></div> <p>Alternatively, return a copy of a private array</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Thing</span><span class="o">[]</span> <span class="no">PRIVATE_VALUES</span> <span class="o">=</span> <span class="o">{</span> <span class="o">...</span> <span class="o">};</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Thing</span><span class="o">&gt;</span> <span class="no">VALUES</span> <span class="o">=</span>
   <span class="nc">Collections</span><span class="o">.</span><span class="na">unmodifiableList</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="no">PRIVATE_VALUES</span><span class="o">));</span>
</code></pre></div></div> <h3 id="in-public-classes-use-accessor-methods-not-public-fields"> <a href="#in-public-classes-use-accessor-methods-not-public-fields" class="anchor-heading" aria-labelledby="in-public-classes-use-accessor-methods-not-public-fields"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> In public classes, use accessor methods, not public fields </h3> <p>Degenerate classes like this should not be public</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kt">double</span> <span class="n">x</span><span class="o">;</span>
   <span class="kd">public</span> <span class="kt">double</span> <span class="n">y</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Because the data fields of such classes are accessed directly, these classes do not offer the benefits of <em>encapsulation</em>. You can’t change the representation without changing the API, you can’t enforce invariants, and you can’t take auxiliary action when a field is accessed.</p> <p>If a class is accessed outside its package, provide accessor methods.</p> <p>If a class is package-private or is a private nested class, there is nothing inherently wrong with exposing its data fields.</p> <h3 id="minimise-mutability"> <a href="#minimise-mutability" class="anchor-heading" aria-labelledby="minimise-mutability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Minimise mutability </h3> <p>An immutable class is simply a class whose instances cannot be modified. <strong>Immutable classes are easier to design, implement, and use than mutable classes. They are less prone to error and are more secure.</strong></p> <ol> <li>Don’t provide methods that modify the object’s state (mutators).</li> <li>Ensure that the class can’t be extended.</li> <li>Make all fields final.</li> <li>Make all fields private.</li> <li>Ensure exclusive access to any mutable components.</li> </ol> <p>Returning new objects on operations is known as <em>functional approach</em> because methods return the result of applying a function to their operand, without modifying it. Contrast it to the <em>procedural</em> or <em>imperative</em> approach in which methods apply a procedure to their operand, causing its state to change. <strong>Method names in immutable objects are prepositions (such as <code class="language-plaintext highlighter-rouge">plus</code>) rather than names (such as <code class="language-plaintext highlighter-rouge">add</code>).</strong></p> <p>Advantages of immutable objects:</p> <ul> <li>Simple.</li> <li>Inherently thread-safe; they require no synchronisation.</li> <li>Can be shared freely.</li> <li>Not only you can share immutable objects, but they can share their internals.</li> <li>Make great building blocks for other objects.</li> <li>Provide failure atomicity for free. There is no possibility of temporary inconsistency.</li> </ul> <p>The main disadvantage immutable objects have is that they require a separate object for each distinct value.</p> <p>Classes should be immutable unless there’s a very good reason to make them mutable.</p> <p>If a class cannot be made immutable, limit its mutability as much as possible. Declare every field <code class="language-plaintext highlighter-rouge">private final</code> unless there’s a good reason to do otherwise.</p> <p>Constructors should create fully initialised objects with all of their invariants established.</p> <h3 id="favour-composition-over-inheritance"> <a href="#favour-composition-over-inheritance" class="anchor-heading" aria-labelledby="favour-composition-over-inheritance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Favour composition over inheritance </h3> <p>Using inheritance inappropriately lead to fragile software. It is safe to use inheritance within a package where programmers have classes and subclasses under control. It is safe to use inheritance when extending classes specifically designed and documented for extension.</p> <p>Unlike method invocation, implementation inheritance violates encapsulation. Subclasses depend on the implementation details of its superclass for its proper function.</p> <p>To avoid fragility use composition and forwarding instead of inheritance, especially if an appropriate interface to implement a wrapper exists. Wrapper classes are not only more robust than subclasses, they are also more powerful.</p> <h3 id="design-and-document-for-inheritance-or-else-prohibit-it"> <a href="#design-and-document-for-inheritance-or-else-prohibit-it" class="anchor-heading" aria-labelledby="design-and-document-for-inheritance-or-else-prohibit-it"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design and document for inheritance or else prohibit it </h3> <p>The class must document its self-use of overridable methods.</p> <p>A class may have to provide hooks into its internal workings in the form of judiciously chosen protected methods.</p> <p><strong>The only way to test a class designed for inheritance is to write subclasses.</strong></p> <p>You must test your class by writing subclasses before you release it.</p> <p>Constructors must not invoke overridable methods. Superclass constructor runs before the subclass constructor. If the overriding method depends on any initialisation performed by the subclass constructor, the method will not behave as expected.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Super</span> <span class="o">{</span>
    <span class="c1">// Broken - constructor invokes an overridable method</span>
    <span class="kd">public</span> <span class="nf">Super</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">overrideMe</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">overrideMe</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Sub</span> <span class="kd">extends</span> <span class="nc">Super</span> <span class="o">{</span>
    <span class="c1">// Blank final, set by constructor</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Instant</span> <span class="n">instant</span><span class="o">;</span>

    <span class="nc">Sub</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">instant</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Overriding method invoked by superclass constructor</span>
    <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">overrideMe</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">instant</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Sub</span> <span class="n">sub</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sub</span><span class="o">();</span><span class="c1">//null</span>
        <span class="n">sub</span><span class="o">.</span><span class="na">overrideMe</span><span class="o">();</span><span class="c1">//instant</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Same restriction applies to <code class="language-plaintext highlighter-rouge">clone</code> and <code class="language-plaintext highlighter-rouge">readObject</code>, they should not invoke overridable methods, directly or indirectly.</p> <p>Designing a class for inheritance requires great effort and places substantial limitations on the class.</p> <p>The best solution to this problem is to prohibit subclassing in classes that are not designed and documented to be safely subclassed. There are two ways of doing this. Declare the class final or make all constructors private or package-private and to add public static factories instead of constructors.</p> <h3 id="prefer-interfaces-to-abstract-classes"> <a href="#prefer-interfaces-to-abstract-classes" class="anchor-heading" aria-labelledby="prefer-interfaces-to-abstract-classes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer interfaces to abstract classes </h3> <p>Existing classes can easily be retrofitted to implement a new interface.</p> <p>Interfaces are ideal for defining <em>mixings</em>, a type that a class can implement in addition to its “primary type”. For example Comparable is a mixing that allows a class can be ordered.</p> <p>Interfaces allow for the construction of nonhierarchical type frameworks.</p> <p>Interfaces enable safe, powerful functionality enhancements via the wrapper class idiom. If you use abstract classes, you leave the programmer who wants to add functionality with no alternative than to use inheritance.</p> <p>You can combine the advantages of interfaces and abstract classes by providing an abstract <em>skeletal implementation class</em> to go with an interface. The interface defines the type, while the skeletal implementation class implements the primitive interface methods (<em>Template Method</em> pattern).</p> <p>Concrete implementation built on top of an skeletal implementation.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">intArrayAsList</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>

    <span class="c1">// The diamond operator is only legal here in Java 9 and later</span>
    <span class="c1">// If you're using an earlier release, specify &lt;Integer&gt;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">AbstractList</span><span class="o">&lt;&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>  <span class="c1">// Autoboxing (Item 6)</span>
        <span class="o">}</span>

        <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">set</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">oldVal</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>     <span class="c1">// Auto-unboxing</span>
            <span class="k">return</span> <span class="n">oldVal</span><span class="o">;</span>  <span class="c1">// Autoboxing</span>
        <span class="o">}</span>

        <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
</code></pre></div></div> <p>Skeletal implementation classes provide implementation assistance of abstract classes without imposing constraints as type definitions.</p> <p>Good documentation is essential in a skeletal implementation.</p> <h3 id="design-interfaces-for-posterity"> <a href="#design-interfaces-for-posterity" class="anchor-heading" aria-labelledby="design-interfaces-for-posterity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design interfaces for posterity </h3> <p>It is not always possible to write a default method that maintains all the invariants of every conceivable implementation.</p> <p>In the presence of default methods, existing implementations of an interface may compile without error or warning but fail at runtime.</p> <p>Is still of the utmost importance to design interfaces with great care. While it may be possible to correct some interface flaws after an interface is released, you cannot count on it.</p> <h3 id="use-interfaces-only-to-define-types"> <a href="#use-interfaces-only-to-define-types" class="anchor-heading" aria-labelledby="use-interfaces-only-to-define-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use interfaces only to define types </h3> <p>Constant interface anti-pattern (only constants) are a poor use of interfaces. Implementing a constant interface causes this implementation detail to leak into the class’s exported API.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PhysicalConstants</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">AVOGADROS_NUMBER</span>   <span class="o">=</span> <span class="mf">6.022_140_857e23</span><span class="o">;</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">BOLTZMANN_CONSTANT</span> <span class="o">=</span> <span class="mf">1.380_648_52</span><span class="n">e</span><span class="o">-</span><span class="mi">23</span><span class="o">;</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">ELECTRON_MASS</span>      <span class="o">=</span> <span class="mf">9.109_383_56</span><span class="n">e</span><span class="o">-</span><span class="mi">31</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>If the constants are strongly tied to a class or interface, you should add them there. If not, a utility class are a good choice</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhysicalConstants</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nf">PhysicalConstants</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>  <span class="c1">// Prevents instantiation</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">AVOGADROS_NUMBER</span> <span class="o">=</span> <span class="mf">6.022_140_857e23</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">BOLTZMANN_CONST</span>  <span class="o">=</span> <span class="mf">1.380_648_52</span><span class="n">e</span><span class="o">-</span><span class="mi">23</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="no">ELECTRON_MASS</span>    <span class="o">=</span> <span class="mf">9.109_383_56</span><span class="n">e</span><span class="o">-</span><span class="mi">31</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="prefer-class-hierarchies-to-tagged-classes"> <a href="#prefer-class-hierarchies-to-tagged-classes" class="anchor-heading" aria-labelledby="prefer-class-hierarchies-to-tagged-classes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer class hierarchies to tagged classes </h3> <p>Tagged class, vastly inferior to a class hierarchy.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="no">RECTANGLE</span><span class="o">,</span> <span class="no">CIRCLE</span> <span class="o">};</span>

    <span class="c1">// Tag field - the shape of this figure</span>
    <span class="kd">final</span> <span class="nc">Shape</span> <span class="n">shape</span><span class="o">;</span>

    <span class="c1">// These fields are used only if shape is RECTANGLE</span>
    <span class="kt">double</span> <span class="n">length</span><span class="o">;</span>
    <span class="kt">double</span> <span class="n">width</span><span class="o">;</span>

    <span class="c1">// This field is used only if shape is CIRCLE</span>
    <span class="kt">double</span> <span class="n">radius</span><span class="o">;</span>

    <span class="c1">// Constructor for circle</span>
    <span class="nc">Figure</span><span class="o">(</span><span class="kt">double</span> <span class="n">radius</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nc">Shape</span><span class="o">.</span><span class="na">CIRCLE</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Constructor for rectangle</span>
    <span class="nc">Figure</span><span class="o">(</span><span class="kt">double</span> <span class="n">length</span><span class="o">,</span> <span class="kt">double</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nc">Shape</span><span class="o">.</span><span class="na">RECTANGLE</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">double</span> <span class="nf">area</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">shape</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">case</span> <span class="nl">RECTANGLE:</span>
            <span class="k">return</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span><span class="o">;</span>
          <span class="k">case</span> <span class="nl">CIRCLE:</span>
            <span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">*</span> <span class="o">(</span><span class="n">radius</span> <span class="o">*</span> <span class="n">radius</span><span class="o">);</span>
          <span class="k">default</span><span class="o">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">(</span><span class="n">shape</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Tagged classes are verbose, error-prone and inefficient.</p> <p>A tagged class is just a pallid imitation of a class hierarchy.</p> <p>With class hierarchy</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">abstract</span> <span class="kt">double</span> <span class="nf">area</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">radius</span><span class="o">;</span>

    <span class="nc">Circle</span><span class="o">(</span><span class="kt">double</span> <span class="n">radius</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">;</span> <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kt">double</span> <span class="nf">area</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">*</span> <span class="o">(</span><span class="n">radius</span> <span class="o">*</span> <span class="n">radius</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="nc">Figure</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">length</span><span class="o">;</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">width</span><span class="o">;</span>

    <span class="nc">Rectangle</span><span class="o">(</span><span class="kt">double</span> <span class="n">length</span><span class="o">,</span> <span class="kt">double</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">width</span>  <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kt">double</span> <span class="nf">area</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="favour-static-member-classes-over-nonstatic"> <a href="#favour-static-member-classes-over-nonstatic" class="anchor-heading" aria-labelledby="favour-static-member-classes-over-nonstatic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Favour static member classes over nonstatic </h3> <p>Typical use of a nonstatic member class</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">AbstractSet</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="o">...</span> <span class="c1">// Bulk of the class omitted</span>

    <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyIterator</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">MyIterator</span> <span class="kd">implements</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <p>If you declare a member class that does not require access to an enclosing instance, always put the <code class="language-plaintext highlighter-rouge">static</code> modifier in its declaration. If you omit this modifier, each instance will have a hidden extraneous reference to its enclosing instance and it will take time and space.</p> <h3 id="limit-source-files-to-a-single-top-level-class"> <a href="#limit-source-files-to-a-single-top-level-class" class="anchor-heading" aria-labelledby="limit-source-files-to-a-single-top-level-class"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Limit source files to a single top-level class </h3> <p>Use static member classes instead of multiple top-level classes. If you do otherwise, your program might not be able to compile or run properly.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Utensil</span><span class="o">.</span><span class="na">NAME</span> <span class="o">+</span> <span class="nc">Dessert</span><span class="o">.</span><span class="na">NAME</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Utensil</span> <span class="o">{</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">NAME</span> <span class="o">=</span> <span class="s">"pan"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Dessert</span> <span class="o">{</span>
        <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">NAME</span> <span class="o">=</span> <span class="s">"cake"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Never put multiple top-level classes or interfaces in a single source file.</p> <h2 id="generics"> <a href="#generics" class="anchor-heading" aria-labelledby="generics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Generics </h2> <h3 id="dont-use-raw-types"> <a href="#dont-use-raw-types" class="anchor-heading" aria-labelledby="dont-use-raw-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Don’t use raw types </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">final</span> <span class="nc">Collection</span> <span class="n">stamps</span> <span class="o">=</span> <span class="o">...</span> <span class="o">;</span>
</code></pre></div></div> <p>If you use raw types, you lose all the safety and expressiveness benefits of generics.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">final</span> <span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Stamp</span><span class="o">&gt;</span> <span class="n">stamps</span> <span class="o">=</span> <span class="o">...</span> <span class="o">;</span>
</code></pre></div></div> <p>You lose type safety if you use a raw type such as <code class="language-plaintext highlighter-rouge">List</code>, but not if you use a parameterised type such as <code class="language-plaintext highlighter-rouge">List&lt;Object&gt;</code>.</p> <p>This method works but it uses raw types, which is dangerous.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">numElementsInCommon</span><span class="o">(</span><span class="nc">Set</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">Set</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span> <span class="n">o1</span> <span class="o">:</span> <span class="n">s1</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s2</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">o1</span><span class="o">))</span>
            <span class="n">result</span><span class="o">++;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Better to use wildcard type.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">numElementsInCommon</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div> <p>You can put <em>any</em> element into a collection with a raw type, easily corrupting the collection type invariant. <strong>You can’t put any element (other than null) into a <code class="language-plaintext highlighter-rouge">Collection&lt;?&gt;</code></strong></p> <p>There are a couple of exceptions to the use of raw types</p> <ul> <li>You must use raw types in class literals, as <code class="language-plaintext highlighter-rouge">List.class</code> is legal, but <code class="language-plaintext highlighter-rouge">List&lt;String&gt;.class</code> is not.</li> <li>Raw types is the preferred way to use the <code class="language-plaintext highlighter-rouge">instanceof</code> operator with generic types <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Set</span><span class="o">)</span> <span class="o">{</span>       <span class="c1">// Raw type</span>
      <span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?&gt;)</span> <span class="n">o</span><span class="o">;</span>    <span class="c1">// Wildcard type</span>
      <span class="o">...</span>
  <span class="o">}</span>
</code></pre></div> </div> </li> </ul> <h3 id="eliminate-unchecked-warnings"> <a href="#eliminate-unchecked-warnings" class="anchor-heading" aria-labelledby="eliminate-unchecked-warnings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Eliminate unchecked warnings </h3> <p>Eliminate every unchecked warning that you can. That will ensure your code is typesafe.</p> <p>If you can’t eliminate a warning, but you can prove that the code that provoked the warning is typesafe, then (and only then) suppress the warning with an <code class="language-plaintext highlighter-rouge">@SupressWarnings("unchecked")</code> annotation.</p> <p>Always use the <code class="language-plaintext highlighter-rouge">SuppressWarnings</code> annotation on the smallest scope possible.</p> <p>Every time you use a <code class="language-plaintext highlighter-rouge">@SuppressWarnings("unchecked")</code> annotation, add a comment saying why it is safe to do so.</p> <h3 id="prefer-lists-to-arrays"> <a href="#prefer-lists-to-arrays" class="anchor-heading" aria-labelledby="prefer-lists-to-arrays"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer lists to arrays </h3> <p>Arrays are <em>covariant</em>, which means that if a <code class="language-plaintext highlighter-rouge">Sub</code> is a subtype of <code class="language-plaintext highlighter-rouge">Super</code>, then array type <code class="language-plaintext highlighter-rouge">Sub[]</code> is a subtype of the array type <code class="language-plaintext highlighter-rouge">Super[]</code>. Generics, by contrast, are <em>invariant</em>, for any two distinct types <code class="language-plaintext highlighter-rouge">Type1</code> and <code class="language-plaintext highlighter-rouge">Type2</code>, <code class="language-plaintext highlighter-rouge">List&lt;Type1&gt;</code> is neither a subtype or a supertype of <code class="language-plaintext highlighter-rouge">List&lt;Type2&gt;</code>.</p> <p>Arrays are deficient, this code fragment is legal and it fails at runtime</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Object</span><span class="o">[]</span> <span class="n">objectArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Long</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="n">objectArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="s">"I don't fit in"</span><span class="o">;</span> <span class="c1">// Throws ArrayStoreException</span>
</code></pre></div></div> <p>This one won’t compile</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">ol</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;();</span> <span class="c1">// Incompatible types</span>
<span class="n">ol</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"I don't fit in"</span><span class="o">);</span>
</code></pre></div></div> <h3 id="favour-generic-types"> <a href="#favour-generic-types" class="anchor-heading" aria-labelledby="favour-generic-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Favour generic types </h3> <p>Generic types are safer and easier to use than types that require casts in client code.When you design new types, make sure that they can be used without such casts.</p> <h3 id="favour-generic-methods"> <a href="#favour-generic-methods" class="anchor-heading" aria-labelledby="favour-generic-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Favour generic methods </h3> <p>Generic methods, like generic types, are safer and easier to use than methods requiring their clients to put explicit casts on input parameters and return types.</p> <h3 id="use-bounded-wildcards-to-increase-api-flexibility"> <a href="#use-bounded-wildcards-to-increase-api-flexibility" class="anchor-heading" aria-labelledby="use-bounded-wildcards-to-increase-api-flexibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use bounded wildcards to increase API flexibility </h3> <p>Wildcard type for a parameter that serves as an E producer</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">pushAll</span><span class="o">(</span><span class="nc">Iterable</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="no">E</span> <span class="n">e</span> <span class="o">:</span> <span class="n">src</span><span class="o">)</span>
        <span class="n">push</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>This would make <code class="language-plaintext highlighter-rouge">Stack&lt;Number&gt;</code> work also on <code class="language-plaintext highlighter-rouge">stack.pushAll(intVal)</code>, as <code class="language-plaintext highlighter-rouge">Integer</code> is a subtype of <code class="language-plaintext highlighter-rouge">Number</code>.</p> <p>Sometimes we would want to do the opposite, have a wildcard type for parameter that serves as an <code class="language-plaintext highlighter-rouge">E</code> consumer.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">popAll</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">dst</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(!</span><span class="n">isEmpty</span><span class="o">())</span>
        <span class="n">dst</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">pop</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div> <p>So we can do</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Collection</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">numberStack</span><span class="o">.</span><span class="na">popAll</span><span class="o">(</span><span class="n">objects</span><span class="o">);</span>
</code></pre></div></div> <p>For maximum flexibility, use wildcard types on input parameters that represent producers or consumers.</p> <p><em>PECS</em> stands for producer-<code class="language-plaintext highlighter-rouge">extends</code> and consumer-<code class="language-plaintext highlighter-rouge">super</code>.</p> <p>Do not use bounded wildcard types as return types. It would force wildcard types on client code.</p> <p><strong>If the user of a class has to think about wildcard types, there is probably something wrong with its API.</strong></p> <p>If a type parameter appears only once in a method declaration, replace it with a wildcard.</p> <h3 id="combine-generics-and-varargs-judiciously"> <a href="#combine-generics-and-varargs-judiciously" class="anchor-heading" aria-labelledby="combine-generics-and-varargs-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Combine generics and varargs judiciously </h3> <p>Mixing generics and varargs can violate type safety.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">void</span> <span class="nf">dangerous</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;...</span> <span class="n">stringLists</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">intList</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">42</span><span class="o">);</span>
    <span class="nc">Object</span><span class="o">[]</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">stringLists</span><span class="o">;</span>
    <span class="n">objects</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">intList</span><span class="o">;</span>             <span class="c1">// Heap pollution</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">stringLists</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// ClassCastException</span>
<span class="o">}</span>
</code></pre></div></div> <p>It is unsafe to store a value in a generic varargs array parameter.</p> <p>The <code class="language-plaintext highlighter-rouge">SafeVarargs</code> annotation constitutes a promise by the author of a method that it is typesafe.</p> <p>This is unsafe, it exposes a reference to its generic parameter array. The compiler might not have enough information to make an accurate determination of the type of the argument and it can propagate heap pollution up the stack.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span><span class="o">[]</span> <span class="nf">toArray</span><span class="o">(</span><span class="no">T</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">args</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>It is unsafe to give another method access to a generic varargs parameter array.</p> <p>Safe method with a generic varargs parameter</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SafeVarargs</span>
<span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">flatten</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;...</span> <span class="n">lists</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">)</span>
        <span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Use <code class="language-plaintext highlighter-rouge">@SafeVarargs</code> on every method with a varargs parameter of a generic or parameterised type.</p> <p>A generic varargs method is safe if:</p> <ol> <li>Does not store anything in the varargs parameter array</li> <li>Does not make the array (or a clone) visible to untrusted code.</li> </ol> <p>Use <code class="language-plaintext highlighter-rouge">List</code> as a typesafe alternative to a generic varargs parameter</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">flatten</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;&gt;</span> <span class="n">lists</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">:</span> <span class="n">lists</span><span class="o">)</span>
        <span class="n">result</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="consider-typesafe-heterogeneous-containers"> <a href="#consider-typesafe-heterogeneous-containers" class="anchor-heading" aria-labelledby="consider-typesafe-heterogeneous-containers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consider typesafe heterogeneous containers </h3> <p>Typesafe heterogeneous container pattern API</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Favorites</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">putFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="no">T</span> <span class="n">instance</span><span class="o">);</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">getFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Typesafe heterogeneous container pattern client</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">Favorites</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Favorites</span><span class="o">();</span>

    <span class="n">f</span><span class="o">.</span><span class="na">putFavorite</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"Java"</span><span class="o">);</span>

    <span class="n">f</span><span class="o">.</span><span class="na">putFavorite</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mh">0xcafebabe</span><span class="o">);</span>

    <span class="n">f</span><span class="o">.</span><span class="na">putFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">Favorites</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>


    <span class="nc">String</span> <span class="n">favoriteString</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getFavorite</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">favoriteInteger</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getFavorite</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">favoriteClass</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">getFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%s %x %s%n"</span><span class="o">,</span> <span class="n">favoriteString</span><span class="o">,</span>

        <span class="n">favoriteInteger</span><span class="o">,</span> <span class="n">favoriteClass</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

<span class="o">}</span>
</code></pre></div></div> <p>A <code class="language-plaintext highlighter-rouge">Favorites</code> instance is <em>typesafe</em>: it will never return an <code class="language-plaintext highlighter-rouge">Integer</code> when you ask it for a <code class="language-plaintext highlighter-rouge">String</code>. It is also <em>heterogeneous</em>: unlike an ordinary map, all the keys are of different types. Therefore, we call <code class="language-plaintext highlighter-rouge">Favorites</code> a <em>typesafe heterogeneous container</em>.</p> <p>Typesafe heterogeneous container pattern - implementation</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Favorites</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Class</span><span class="o">&lt;?&gt;,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">favorites</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">putFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="no">T</span> <span class="n">instance</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">favorites</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">type</span><span class="o">),</span> <span class="n">instance</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">getFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">type</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">favorites</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Achieving runtime type safety with a dynamic cast</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="nf">putFavorite</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="no">T</span> <span class="n">instance</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">favorites</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">type</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">instance</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="enums-and-annotations"> <a href="#enums-and-annotations" class="anchor-heading" aria-labelledby="enums-and-annotations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enums and annotations </h2> <h3 id="use-enums-instead-of-int-constants"> <a href="#use-enums-instead-of-int-constants" class="anchor-heading" aria-labelledby="use-enums-instead-of-int-constants"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use enums instead of int constants </h3> <p>The <em><code class="language-plaintext highlighter-rouge">int</code> enum pattern</em> provides nothing in the way of type safety and little in the way of expressive power.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">APPLE_FUJI</span>         <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">APPLE_PIPPIN</span>       <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">APPLE_GRANNY_SMITH</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">ORANGE_NAVEL</span>  <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">ORANGE_TEMPLE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">ORANGE_BLOOD</span>  <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Apple</span>  <span class="o">{</span> <span class="no">FUJI</span><span class="o">,</span> <span class="no">PIPPIN</span><span class="o">,</span> <span class="no">GRANNY_SMITH</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Orange</span> <span class="o">{</span> <span class="no">NAVEL</span><span class="o">,</span> <span class="no">TEMPLE</span><span class="o">,</span> <span class="no">BLOOD</span> <span class="o">}</span>
</code></pre></div></div> <p>Java’s enum types are classes that export one instance for each enumeration constant via a public static field num. Enum are effectively final because they have no accessible constructors.</p> <p>They are type safe, if you declare a parameter to be of type <code class="language-plaintext highlighter-rouge">Apple</code>, you are guaranteed that any non-null object reference passed to the parameter is one of the three valid <code class="language-plaintext highlighter-rouge">Apple</code> values.</p> <p>Enum types let you add arbitrary methods, provide high-quality implementations of all the <code class="language-plaintext highlighter-rouge">Object</code> methods, they implement <code class="language-plaintext highlighter-rouge">Comparable</code> and <code class="language-plaintext highlighter-rouge">Serializable</code>.</p> <p>To associate data with enum constants, declare instance fields and write constructor that takes the data and stores it in the fields.</p> <p>Enum type that switches on its own value, questionable.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Operation</span> <span class="o">{</span>
    <span class="no">PLUS</span><span class="o">,</span> <span class="no">MINUS</span><span class="o">,</span> <span class="no">TIMES</span><span class="o">,</span> <span class="no">DIVIDE</span><span class="o">;</span>

    <span class="c1">// Do the arithmetic operation represented by this constant</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nl">PLUS:</span>   <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">MINUS:</span>  <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">TIMES:</span>  <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
            <span class="k">case</span> <span class="nl">DIVIDE:</span> <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">AssertionError</span><span class="o">(</span><span class="s">"Unknown op: "</span> <span class="o">+</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Enum type with constant-specific method implementations</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Operation</span> <span class="o">{</span>
  <span class="no">PLUS</span>  <span class="o">{</span><span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">){</span><span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;}},</span>
  <span class="no">MINUS</span> <span class="o">{</span><span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">){</span><span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">;}},</span>
  <span class="no">TIMES</span> <span class="o">{</span><span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">){</span><span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;}},</span>
  <span class="no">DIVIDE</span><span class="o">{</span><span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">){</span><span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="o">;}};</span>

  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Enum type with constant-specific class bodies and data</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Operation</span> <span class="o">{</span>
    <span class="no">PLUS</span><span class="o">(</span><span class="s">"+"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">MINUS</span><span class="o">(</span><span class="s">"-"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">TIMES</span><span class="o">(</span><span class="s">"*"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">DIVIDE</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">symbol</span><span class="o">;</span>

    <span class="nc">Operation</span><span class="o">(</span><span class="nc">String</span> <span class="n">symbol</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">;</span> <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">symbol</span><span class="o">;</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Use enums any time you need a set of constants whose members are known at compile time.</strong> It is not necessary that the set of constants in an enum type stay fixed for all time, the enum was specifically designed to allow evolution of enum types.</p> <h3 id="use-instance-fields-instead-of-ordinals"> <a href="#use-instance-fields-instead-of-ordinals" class="anchor-heading" aria-labelledby="use-instance-fields-instead-of-ordinals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use instance fields instead of ordinals </h3> <p>Abuse of ordinal to derive an associated value, <strong>don’t do this</strong>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Ensemble</span> <span class="o">{</span>
    <span class="no">SOLO</span><span class="o">,</span>   <span class="no">DUET</span><span class="o">,</span>   <span class="no">TRIO</span><span class="o">,</span> <span class="no">QUARTET</span><span class="o">,</span> <span class="no">QUINTET</span><span class="o">,</span>
    <span class="no">SEXTET</span><span class="o">,</span> <span class="no">SEPTET</span><span class="o">,</span> <span class="no">OCTET</span><span class="o">,</span> <span class="no">NONET</span><span class="o">,</span>  <span class="no">DECTET</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">numberOfMusicians</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">ordinal</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Never derive a value associated with an enum from its ordinal; store it in an instance field instead.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Ensemble</span> <span class="o">{</span>
    <span class="no">SOLO</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="no">DUET</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="no">TRIO</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="no">QUARTET</span><span class="o">(</span><span class="mi">4</span><span class="o">),</span> <span class="no">QUINTET</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span>
    <span class="no">SEXTET</span><span class="o">(</span><span class="mi">6</span><span class="o">),</span> <span class="no">SEPTET</span><span class="o">(</span><span class="mi">7</span><span class="o">),</span> <span class="no">OCTET</span><span class="o">(</span><span class="mi">8</span><span class="o">),</span> <span class="no">DOUBLE_QUARTET</span><span class="o">(</span><span class="mi">8</span><span class="o">),</span>
    <span class="no">NONET</span><span class="o">(</span><span class="mi">9</span><span class="o">),</span> <span class="no">DECTET</span><span class="o">(</span><span class="mi">10</span><span class="o">),</span> <span class="no">TRIPLE_QUARTET</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">numberOfMusicians</span><span class="o">;</span>

    <span class="nc">Ensemble</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">numberOfMusicians</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">numberOfMusicians</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">numberOfMusicians</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="use-enumset-instead-of-bit-fields"> <a href="#use-enumset-instead-of-bit-fields" class="anchor-heading" aria-labelledby="use-enumset-instead-of-bit-fields"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use <code class="language-plaintext highlighter-rouge">EnumSet</code> instead of bit fields </h3> <p>Bit field enumeration constants, obsolete.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Text</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">STYLE_BOLD</span>          <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="o">;</span>  <span class="c1">// 1</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">STYLE_ITALIC</span>        <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="o">;</span>  <span class="c1">// 2</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">STYLE_UNDERLINE</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="o">;</span>  <span class="c1">// 4</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">STYLE_STRIKETHROUGH</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="o">;</span>  <span class="c1">// 8</span>

    <span class="c1">// Parameter is bitwise OR of zero or more STYLE_ constants</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">applyStyles</span><span class="o">(</span><span class="kt">int</span> <span class="n">styles</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>This representation lets you use the bitwise <code class="language-plaintext highlighter-rouge">OR</code> operation to combine several constants into a set, known as a <em>bit field</em></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span><span class="o">.</span><span class="na">applyStyles</span><span class="o">(</span><span class="no">STYLE_BOLD</span> <span class="o">|</span> <span class="no">STYLE_ITALIC</span><span class="o">);</span>
</code></pre></div></div> <p><em>Bit fields</em> have all the disadvantages than <code class="language-plaintext highlighter-rouge">int</code> enum pattern. A better alternative is to use <code class="language-plaintext highlighter-rouge">EnumSet</code></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Text</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Style</span> <span class="o">{</span> <span class="no">BOLD</span><span class="o">,</span> <span class="no">ITALIC</span><span class="o">,</span> <span class="no">UNDERLINE</span><span class="o">,</span> <span class="no">STRIKETHROUGH</span> <span class="o">}</span>

    <span class="c1">// Any Set could be passed in, but EnumSet is clearly best</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">applyStyles</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Style</span><span class="o">&gt;</span> <span class="n">styles</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>So you could use it like</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span><span class="o">.</span><span class="na">applyStyles</span><span class="o">(</span><span class="nc">EnumSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Style</span><span class="o">.</span><span class="na">BOLD</span><span class="o">,</span> <span class="nc">Style</span><span class="o">.</span><span class="na">ITALIC</span><span class="o">));</span>
</code></pre></div></div> <p><strong>Just because an enumerated type will be used in sets, there is no reason to represent it with bit fields.</strong></p> <h3 id="use-enummap-instead-of-ordinal-indexing"> <a href="#use-enummap-instead-of-ordinal-indexing" class="anchor-heading" aria-labelledby="use-enummap-instead-of-ordinal-indexing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use <code class="language-plaintext highlighter-rouge">EnumMap</code> instead of ordinal indexing </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Plant</span> <span class="o">{</span>
    <span class="kd">enum</span> <span class="nc">LifeCycle</span> <span class="o">{</span> <span class="no">ANNUAL</span><span class="o">,</span> <span class="no">PERENNIAL</span><span class="o">,</span> <span class="no">BIENNIAL</span> <span class="o">}</span>

    <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">LifeCycle</span> <span class="n">lifeCycle</span><span class="o">;</span>

    <span class="nc">Plant</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">LifeCycle</span> <span class="n">lifeCycle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lifeCycle</span> <span class="o">=</span> <span class="n">lifeCycle</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Using <code class="language-plaintext highlighter-rouge">ordinal()</code> to index into an array, <strong>don’t do this</strong>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Plant</span><span class="o">&gt;[]</span> <span class="n">plantsByLifeCycle</span> <span class="o">=</span>
    <span class="o">(</span><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Plant</span><span class="o">&gt;[])</span> <span class="k">new</span> <span class="nc">Set</span><span class="o">[</span><span class="nc">Plant</span><span class="o">.</span><span class="na">LifeCycle</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">length</span><span class="o">];</span>

<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">plantsByLifeCycle</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
    <span class="n">plantsByLifeCycle</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Plant</span> <span class="n">p</span> <span class="o">:</span> <span class="n">garden</span><span class="o">)</span>
    <span class="n">plantsByLifeCycle</span><span class="o">[</span><span class="n">p</span><span class="o">.</span><span class="na">lifeCycle</span><span class="o">.</span><span class="na">ordinal</span><span class="o">()].</span><span class="na">add</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>

<span class="c1">// Print the results</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">plantsByLifeCycle</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%s: %s%n"</span><span class="o">,</span>
        <span class="nc">Plant</span><span class="o">.</span><span class="na">LifeCycle</span><span class="o">.</span><span class="na">values</span><span class="o">()[</span><span class="n">i</span><span class="o">],</span> <span class="n">plantsByLifeCycle</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Using an <code class="language-plaintext highlighter-rouge">EnumMap</code> to associate data with an enum</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Map&lt;Plant.LifeCycle, Set&lt;Plant&gt;&gt;  plantsByLifeCycle =
    new EnumMap&lt;&gt;(Plant.LifeCycle.class);
for (Plant.LifeCycle lc : Plant.LifeCycle.values())
    plantsByLifeCycle.put(lc, new HashSet&lt;&gt;());
for (Plant p : garden)
    plantsByLifeCycle.get(p.lifeCycle).add(p);
System.out.println(plantsByLifeCycle);
</code></pre></div></div> <p>Or even a shorter version, a bit naive as it doesn’t produce an <code class="language-plaintext highlighter-rouge">EnumMap</code></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">garden</span><span class="o">)</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">groupingBy</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="na">lifeCycle</span><span class="o">)));</span>
</code></pre></div></div> <p>Fixed version</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">garden</span><span class="o">)</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">groupingBy</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="na">lifeCycle</span><span class="o">,</span>
        <span class="o">()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">EnumMap</span><span class="o">&lt;&gt;(</span><span class="nc">LifeCycle</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">toSet</span><span class="o">())));</span>
</code></pre></div></div> <p><strong>It is rarely appropriate to use ordinals to index into arrays: use EnumMap instead</strong>.</p> <h3 id="emulate-extensible-enums-with-interfaces"> <a href="#emulate-extensible-enums-with-interfaces" class="anchor-heading" aria-labelledby="emulate-extensible-enums-with-interfaces"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Emulate extensible enums with interfaces </h3> <p>In the case for <em>opcodes</em>, <em>operation codes</em> that represent operations in some machine, is desirable to let the user of an API provide their own operations, effectively extending the set of operations provided by the API.</p> <p>You can do this by implementing interfaces.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Operation</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">BasicOperation</span> <span class="kd">implements</span> <span class="nc">Operation</span> <span class="o">{</span>
    <span class="no">PLUS</span><span class="o">(</span><span class="s">"+"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">MINUS</span><span class="o">(</span><span class="s">"-"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">TIMES</span><span class="o">(</span><span class="s">"*"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">DIVIDE</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
    <span class="o">};</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">symbol</span><span class="o">;</span>

    <span class="nc">BasicOperation</span><span class="o">(</span><span class="nc">String</span> <span class="n">symbol</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">symbol</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>And an emulated extension enum</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">ExtendedOperation</span> <span class="kd">implements</span> <span class="nc">Operation</span> <span class="o">{</span>
    <span class="no">EXP</span><span class="o">(</span><span class="s">"^"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">},</span>
    <span class="no">REMAINDER</span><span class="o">(</span><span class="s">"%"</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">symbol</span><span class="o">;</span>

    <span class="nc">ExtendedOperation</span><span class="o">(</span><span class="nc">String</span> <span class="n">symbol</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">symbol</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Now you can use your new operations anywhere you could use the basic operations, provided that API’s are written to take the interface type <code class="language-plaintext highlighter-rouge">Operation</code>, not the implementation <code class="language-plaintext highlighter-rouge">BasicOperation</code>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Operation</span><span class="o">&gt;</span> <span class="n">opSet</span><span class="o">);</span>
</code></pre></div></div> <p>While you cannot write an extensible enum type, you can emulate it by writing an interface to accompany a basic enum type that implements the interface.</p> <h3 id="prefer-annotations-to-naming-patterns"> <a href="#prefer-annotations-to-naming-patterns" class="anchor-heading" aria-labelledby="prefer-annotations-to-naming-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer annotations to naming patterns </h3> <p>It’s been common to use <em>naming patterns</em> to indicate that some program elements demanded special treatment by a tool or framework. Like prefixing your tests with <code class="language-plaintext highlighter-rouge">test</code> word, so JUnit 3 would pick it up. These have many disadvantages:</p> <ol> <li>Typographical errors result in silent failures. Imagine you accidentally named a test method <code class="language-plaintext highlighter-rouge">tsetSomething</code> instead of <code class="language-plaintext highlighter-rouge">testSomething</code>. JUnit 3 wouldn’t complain, but it wouldn’t run the test either.</li> <li>There is no way to ensure that they are used only on appropriate program elements. Imagine creating a class <code class="language-plaintext highlighter-rouge">TestSafetyMechanism</code> in the hopes that JUnit 3 would automatically test its methods.</li> <li>They provide no good way to associate parameter values with program elements. Suppose you want to support a category of test that succeeds only if it throws a particular exception, the exception type is the parameter of the test. You could encode the exception type in the test name but the compiler would have no way of knowing to check the string that was supposed to name the exception.</li> </ol> <p>Annotations solve all these problems nicely, and JUnit adopted them starting with release 4.</p> <p>Marker annotation type declaration</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.lang.annotation.*</span><span class="o">;</span>

<span class="cm">/**
 * Indicates that the annotated method is a test method.
 * Use only on parameterless static methods.
 */</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">Test</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div> <p>Program to process marker annotations</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.lang.reflect.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RunTests</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">tests</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">passed</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">testClass</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Method</span> <span class="n">m</span> <span class="o">:</span> <span class="n">testClass</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">isAnnotationPresent</span><span class="o">(</span><span class="nc">Test</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">tests</span><span class="o">++;</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
                    <span class="n">passed</span><span class="o">++;</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InvocationTargetException</span> <span class="n">wrappedExc</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Throwable</span> <span class="n">exc</span> <span class="o">=</span> <span class="n">wrappedExc</span><span class="o">.</span><span class="na">getCause</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span> <span class="o">+</span> <span class="s">" failed: "</span> <span class="o">+</span> <span class="n">exc</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">exc</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Invalid @Test: "</span> <span class="o">+</span> <span class="n">m</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Passed: %d, Failed: %d%n"</span><span class="o">,</span>
                          <span class="n">passed</span><span class="o">,</span> <span class="n">tests</span> <span class="o">-</span> <span class="n">passed</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>There is no reason to use naming patterns when you can use annotations instead.</p> <p>With the exception of toolshmiths, most programmers will have no need to define annotation types. All programmers should use the predefined annotations types that Java provides.</p> <h3 id="consistently-use-the-override-annotation"> <a href="#consistently-use-the-override-annotation" class="anchor-heading" aria-labelledby="consistently-use-the-override-annotation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consistently use the override annotation </h3> <p>Buggy code, spot the error.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Bigram</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">first</span> <span class="o">==</span> <span class="n">first</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">second</span> <span class="o">==</span> <span class="n">second</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>With an <code class="language-plaintext highlighter-rouge">Override</code>, the program won’t compile</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Bigram</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">first</span> <span class="o">==</span> <span class="n">first</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">second</span> <span class="o">==</span> <span class="n">second</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Override will check overriding method at compile time. <code class="language-plaintext highlighter-rouge">equals</code> requires the parameter to be type <code class="language-plaintext highlighter-rouge">Object</code>. The fixed version</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Bigram</span><span class="o">))</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

    <span class="nc">Bigram</span> <span class="n">b</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Bigram</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">first</span> <span class="o">==</span> <span class="n">first</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">.</span><span class="na">second</span> <span class="o">==</span> <span class="n">second</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div> <p>Use the <code class="language-plaintext highlighter-rouge">Override</code> annotation on every method declaration that you believe to override a superclass declaration.</p> <h3 id="use-marker-interfaces-to-define-types"> <a href="#use-marker-interfaces-to-define-types" class="anchor-heading" aria-labelledby="use-marker-interfaces-to-define-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use marker interfaces to define types </h3> <p>A <em>marker interface</em> is an interface that contains no method declarations but merely designates (or “marks”) a class that implements the interface as having some property. An example of this is the <code class="language-plaintext highlighter-rouge">Serializable</code> interface.</p> <p>Marker interfaces define a type that is implemented by instances of the marked class; marker annotations do not. <strong>The existence of a marker interface type allows you to catch errors at compile time that you couldn’t catch until runtime if you used a marker annotation.</strong></p> <p>Another advantage of marker interfaces over marker annotations is that they can be targeted more precisely. If an annotation is declared with target <code class="language-plaintext highlighter-rouge">ElementType.TYPE</code>, it can be applied to <em>any</em> class or interface.</p> <p>The chief advantage of a marker annotation over marker interfaces is that they are part of the larger annotation facility. Marker annotations allow for consistency in annotation-based frameworks.</p> <p>If you find yourself writing a marker annotation type whose target is <code class="language-plaintext highlighter-rouge">ElementType.TYPE</code>, take the time to figure out whether it is really should be an annotation type or whether a marker interface would be more appropriate.</p> <h2 id="lambdas-and-streams"> <a href="#lambdas-and-streams" class="anchor-heading" aria-labelledby="lambdas-and-streams"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lambdas and streams </h2> <h3 id="prefer-lambdas-to-anonymous-classes"> <a href="#prefer-lambdas-to-anonymous-classes" class="anchor-heading" aria-labelledby="prefer-lambdas-to-anonymous-classes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer lambdas to anonymous classes </h3> <p>Obsolete</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">words</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">String</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre></div></div> <p>Lambda expression as function object</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">words</span><span class="o">,</span>
        <span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">()));</span>
</code></pre></div></div> <p>Omit the types of all lambda parameters unless their presence makes your program clearer.</p> <p>Enum with function object fields and constant-specific behaviour</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Operation</span> <span class="o">{</span>
    <span class="no">PLUS</span>  <span class="o">(</span><span class="s">"+"</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">),</span>
    <span class="no">MINUS</span> <span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">),</span>
    <span class="no">TIMES</span> <span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">),</span>
    <span class="no">DIVIDE</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">symbol</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">DoubleBinaryOperator</span> <span class="n">op</span><span class="o">;</span>

    <span class="nc">Operation</span><span class="o">(</span><span class="nc">String</span> <span class="n">symbol</span><span class="o">,</span> <span class="nc">DoubleBinaryOperator</span> <span class="n">op</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">op</span> <span class="o">=</span> <span class="n">op</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">symbol</span><span class="o">;</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">apply</span><span class="o">(</span><span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="kt">double</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="na">applyAsDouble</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Lambdas lack names and documentation; if a computation isn’t self-explanatory, or exceeds a few lines (more than three), don’t put it in a lambda.</p> <p>You should rarely, if eve, serialise a lambda.</p> <p>Don’t use anonymous classes for function objects unless you have to create instances of types that aren’t functional interfaces.</p> <h3 id="prefer-method-references-to-lambdas"> <a href="#prefer-method-references-to-lambdas" class="anchor-heading" aria-labelledby="prefer-method-references-to-lambdas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer method references to lambdas </h3> <p>Where method references are shorter and clearer, use them; where they aren’t, stick with lambdas.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="n">count</span><span class="o">,</span> <span class="n">incr</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">count</span> <span class="o">+</span> <span class="n">incr</span><span class="o">);</span>
</code></pre></div></div> <p>to</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">);</span>
</code></pre></div></div> <p>All kinds of method references are summarised below</p> <div class="table-wrapper"><table> <thead> <tr> <th>Method Ref Type</th> <th>Example</th> <th>Lambda equivalent</th> </tr> </thead> <tbody> <tr> <td>Static</td> <td><code class="language-plaintext highlighter-rouge">Integer::parseInt</code></td> <td><code class="language-plaintext highlighter-rouge">str -&gt; Integer.parseInt(str)</code></td> </tr> <tr> <td>Bound</td> <td><code class="language-plaintext highlighter-rouge">Instant.now()::isAfter</code></td> <td><code class="language-plaintext highlighter-rouge">Instant then = Instant.now(); t -&gt; then.isAfter(t)</code></td> </tr> <tr> <td>Unbound</td> <td><code class="language-plaintext highlighter-rouge">String::toLowerCase</code></td> <td><code class="language-plaintext highlighter-rouge">str -&gt; str.toLowerCase()</code></td> </tr> <tr> <td>Class Constructor</td> <td><code class="language-plaintext highlighter-rouge">TreeMap&lt;K,V&gt;::new</code></td> <td><code class="language-plaintext highlighter-rouge">() -&gt; new TreeMap&lt;K,V&gt;</code></td> </tr> <tr> <td>Array Constructor</td> <td><code class="language-plaintext highlighter-rouge">int[]::new</code></td> <td><code class="language-plaintext highlighter-rouge">len -&gt; new int[len]</code></td> </tr> </tbody> </table></div> <h3 id="favour-the-use-of-standard-functional-interfaces"> <a href="#favour-the-use-of-standard-functional-interfaces" class="anchor-heading" aria-labelledby="favour-the-use-of-standard-functional-interfaces"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Favour the use of standard functional interfaces </h3> <p>Unnecessary functional interface; use a standard one instead.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FunctionalInterface</span> <span class="kd">interface</span> <span class="nc">EldestEntryRemovalFunction</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;{</span>
    <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span><span class="no">V</span><span class="o">&gt;</span> <span class="n">eldest</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>If one of the standard functional interfaces does the job, you should generally use it in preference to a purpose-built functional interface.</p> <p>The six basic functional interfaces are summarised below</p> <div class="table-wrapper"><table> <thead> <tr> <th>Interface</th> <th>Function Signature</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">UnaryOperator&lt;T&gt;</code></td> <td><code class="language-plaintext highlighter-rouge">T apply(T t)</code></td> <td><code class="language-plaintext highlighter-rouge">String::toLowerCase</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">BinaryOperator&lt;T&gt;</code></td> <td><code class="language-plaintext highlighter-rouge">T apply(T t1, T t2)</code></td> <td><code class="language-plaintext highlighter-rouge">BigInteger::add</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Predicate&lt;T&gt;</code></td> <td><code class="language-plaintext highlighter-rouge">boolean test(T t)</code></td> <td><code class="language-plaintext highlighter-rouge">Collection::isEmpty</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Function&lt;T,R&gt;</code></td> <td><code class="language-plaintext highlighter-rouge">R apply(T t)</code></td> <td><code class="language-plaintext highlighter-rouge">Arrays::asList</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Supplier&lt;T&gt;</code></td> <td><code class="language-plaintext highlighter-rouge">T get()</code></td> <td><code class="language-plaintext highlighter-rouge">Instant::now</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">Consumer&lt;T&gt;</code></td> <td><code class="language-plaintext highlighter-rouge">void accept(T t)</code></td> <td><code class="language-plaintext highlighter-rouge">System.out.println</code></td> </tr> </tbody> </table></div> <p>Don’t be tempted to use basic functional interfaces with boxed primitives instead of primitive functional interfaces (prefer primitive types to boxed primitives, performance will suffer otherwise).</p> <p><strong>Always annotate your functional interfaces with the <code class="language-plaintext highlighter-rouge">@FunctionalInterface</code> annotation.</strong> Its behaviour is similar to <code class="language-plaintext highlighter-rouge">@Override</code>, it tells the readers that the class was designed to enable lambdas; it won’t compile unless it has exactly one abstract method; it prevents maintainers from accidentally adding abstract methods to the interface as it evolves.</p> <h3 id="use-streams-judiciously"> <a href="#use-streams-judiciously" class="anchor-heading" aria-labelledby="use-streams-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use streams judiciously </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">words</span><span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">groupingBy</span><span class="o">(</span><span class="n">word</span> <span class="o">-&gt;</span> <span class="n">alphabetize</span><span class="o">(</span><span class="n">word</span><span class="o">)))</span>
      <span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
      <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">group</span> <span class="o">-&gt;</span> <span class="n">group</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">minGroupSize</span><span class="o">)</span>
      <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">g</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">g</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">g</span><span class="o">));</span>
</code></pre></div></div> <p>Stream pipelines are evaluated <code class="language-plaintext highlighter-rouge">lazily</code>, evaluation doesn’t start until the terminal operation is invoked.</p> <p>Overusing streams makes programs hard to read and maintain.</p> <p>In the absence of explicit types, careful naming of lambda parameters is essential to the readability of stream pipelines.</p> <p>Using helper methods is even more important for readability in stream pipelines than in iterative code because pipelines lack explicit type information.</p> <p>If you are not sure whether a task is better served by streams or iteration, try both and see which works better.</p> <h3 id="prefer-side-effect-free-functions-in-streams"> <a href="#prefer-side-effect-free-functions-in-streams" class="anchor-heading" aria-labelledby="prefer-side-effect-free-functions-in-streams"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer side-effect-free functions in streams </h3> <p>The following code uses the streams API but not the paradigm, don’t do this.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Map&lt;String, Long&gt; freq = new HashMap&lt;&gt;();
try (Stream&lt;String&gt; words = new Scanner(file).tokens()) {
    words.forEach(word -&gt; {
        freq.merge(word.toLowerCase(), 1L, Long::sum);
    });
}
</code></pre></div></div> <p>Proper use of streams</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Map&lt;String, Long&gt; freq;
try (Stream&lt;String&gt; words = new Scanner(file).tokens()) {
    freq = words
        .collect(groupingBy(String::toLowerCase, counting()));
}
</code></pre></div></div> <p><strong>The <code class="language-plaintext highlighter-rouge">forEach</code> operation should be used only to report the result of a stream computation, not to perform the computation.</strong></p> <p>Pipeline to get a top-ten list of words from a frequency table</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">topTen</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">sorted</span><span class="o">(</span><span class="n">comparing</span><span class="o">(</span><span class="nl">freq:</span><span class="o">:</span><span class="n">get</span><span class="o">).</span><span class="na">reversed</span><span class="o">())</span>
    <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
    <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span>
</code></pre></div></div> <p><strong>It is customary and wise to statically import all members of <code class="language-plaintext highlighter-rouge">Collectors</code> because it makes stream pipelines more readable.</strong></p> <h3 id="prefer-collection-to-stream-as-a-return-type"> <a href="#prefer-collection-to-stream-as-a-return-type" class="anchor-heading" aria-labelledby="prefer-collection-to-stream-as-a-return-type"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer <code class="language-plaintext highlighter-rouge">Collection</code> to <code class="language-plaintext highlighter-rouge">Stream</code> as a return type </h3> <p>Streams do not make iteration obsolete, writing good code requires combining streams and iteration judiciously.</p> <p>The <code class="language-plaintext highlighter-rouge">Collection</code> interface is a subtype of <code class="language-plaintext highlighter-rouge">Iterable</code> and has a <code class="language-plaintext highlighter-rouge">stream</code> method, so it provides both iteration and stream access. <strong><code class="language-plaintext highlighter-rouge">Collection</code> or an appropriate subtype is generally the best return type for a public, sequence-returning method.</strong> But do not store large sequence in memory just to return it as a collection. If the sequence you’re returning is large but can be represented concisely, consider implementing a special-purpose collection.</p> <h3 id="use-caution-when-making-streams-parallel"> <a href="#use-caution-when-making-streams-parallel" class="anchor-heading" aria-labelledby="use-caution-when-making-streams-parallel"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use caution when making streams parallel </h3> <p>Parallelising a pipeline is unlikely to increase its performance if the source is from <code class="language-plaintext highlighter-rouge">Stream.iterate</code>, or the intermediate operation <code class="language-plaintext highlighter-rouge">limit</code> is used.</p> <p>Do not parallelise stream pipelines indiscriminately.</p> <p>As a rule, performance gains from parallelism are best on streams over <code class="language-plaintext highlighter-rouge">ArrayList</code>, <code class="language-plaintext highlighter-rouge">HashMap</code>, <code class="language-plaintext highlighter-rouge">HashSet</code>, and <code class="language-plaintext highlighter-rouge">ConcurrentHashMap</code> instances; arrays; <code class="language-plaintext highlighter-rouge">int</code> ranges; and <code class="language-plaintext highlighter-rouge">long</code> ranges. What all these data structures have in common is that they can be cheaply split into subranges of any desired sizes, which makes them easy to divide work among parallel threads.</p> <p><strong>Not only can parallelising a stream lead to poor performance, including liveness failures; it can lead to incorrect results and unpredictable behaviour.</strong></p> <p>Under the right circumstances, it is possible to achieve near-linear speedup in the number of processor cores simply by adding a <code class="language-plaintext highlighter-rouge">parallel</code> call to a stream pipeline.</p> <h2 id="methods"> <a href="#methods" class="anchor-heading" aria-labelledby="methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Methods </h2> <h3 id="check-parameters-for-validity"> <a href="#check-parameters-for-validity" class="anchor-heading" aria-labelledby="check-parameters-for-validity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Check parameters for validity </h3> <p>Each time you write a method or constructor, you should think about what restrictions exist on its parameters. You should document these restrictions and enforce them with explicit checks at the beginning of the method body.</p> <p>If an invalid parameter value is passed to a method and the method checks its parameters before execution, it will fail quickly and cleanly with an appropriate exception.</p> <p>The <code class="language-plaintext highlighter-rouge">Objets.requireNonNull</code> method, added in Java 7, is flexible and convenient, so there’s no reason to perform null checks manually anymore.</p> <p>For an unexported method, you control the circumstances under which the method is called, so you can and should ensure that only valid parameter values are passed in. Nonpublic methods can check their parameters using <em>assertions</em>.</p> <h3 id="make-defensive-copies-when-needed"> <a href="#make-defensive-copies-when-needed" class="anchor-heading" aria-labelledby="make-defensive-copies-when-needed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make defensive copies when needed </h3> <p>You must program defensively, with the assumption that clients of your class will do their best to destroy its invariants.</p> <p>Broken “immutable” time period class</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Period</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">start</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">end</span><span class="o">;</span>

    <span class="cm">/**
     * @param  start the beginning of the period
     * @param  end the end of the period; must not precede start
     * @throws IllegalArgumentException if start is after end
     * @throws NullPointerException if start or end is null
     */</span>
    <span class="kd">public</span> <span class="nf">Period</span><span class="o">(</span><span class="nc">Date</span> <span class="n">start</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">end</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span>
                <span class="n">start</span> <span class="o">+</span> <span class="s">" after "</span> <span class="o">+</span> <span class="n">end</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">end</span>   <span class="o">=</span> <span class="n">end</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">start</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">end</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Attack the internals of <code class="language-plaintext highlighter-rouge">Period</code> instance</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Date</span> <span class="n">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
<span class="nc">Date</span> <span class="n">end</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
<span class="nc">Period</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Period</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
<span class="n">end</span><span class="o">.</span><span class="na">setYear</span><span class="o">(</span><span class="mi">78</span><span class="o">);</span>  <span class="c1">// Modifies internals of p!</span>
</code></pre></div></div> <p>It is essential to make a defensive copy of each mutable parameter to the constructor.</p> <p>Repaired constructor, makes defensive copies of parameters.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">Period</span><span class="o">(</span><span class="nc">Date</span> <span class="n">start</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
    <span class="k">this</span><span class="o">.</span><span class="na">end</span>   <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">end</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>

    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">start</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">end</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span>
          <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">+</span> <span class="s">" after "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">end</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Defensive copies are made before checking the validity of the parameters, and the validity check is performed on the copies rather than the originals.</p> <p>Do not use the <code class="language-plaintext highlighter-rouge">clone</code> method to make a defensive copy of a parameter whose type is subclassable by untrusted parties.</p> <p>Second attack on the internals of a <code class="language-plaintext highlighter-rouge">Period</code> instance</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Date</span> <span class="n">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
<span class="nc">Date</span> <span class="n">end</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
<span class="nc">Period</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Period</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
<span class="n">p</span><span class="o">.</span><span class="na">end</span><span class="o">().</span><span class="na">setYear</span><span class="o">(</span><span class="mi">78</span><span class="o">);</span>  <span class="c1">// Modifies internals of p!</span>
</code></pre></div></div> <p>Return defensive copies of mutable internal fields.</p> <p>Repaired accessors, make defensive copies of internal fields</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Date</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nc">Date</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="n">end</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div> <p>You should, where possible, use immutable objects as components of your objects so that you don’t have to worry about defensive copying.</p> <h3 id="design-method-signature-carefully"> <a href="#design-method-signature-carefully" class="anchor-heading" aria-labelledby="design-method-signature-carefully"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design method signature carefully </h3> <ul> <li>Choose method names carefully.</li> <li>Don’t go overboard in providing convenience methods. When in doubt, leave it out.</li> <li>Avoid long parameter lists. Aim for four parameters or fewer. Long sequences of identically typed parameters are especially harmful.</li> <li>For parameter types, favour interfaces over classes.</li> <li>Prefer two-element enum types to <code class="language-plaintext highlighter-rouge">boolean</code> parameters. <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">public</span> <span class="kd">enum</span> <span class="nc">TemperatureScale</span> <span class="o">{</span> <span class="no">FAHRENHEIT</span><span class="o">,</span> <span class="no">CELSIUS</span> <span class="o">}</span>
</code></pre></div> </div> </li> </ul> <h3 id="use-overloading-judiciously"> <a href="#use-overloading-judiciously" class="anchor-heading" aria-labelledby="use-overloading-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use overloading judiciously </h3> <p>What does this program print?</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CollectionClassifier</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">classify</span><span class="o">(</span><span class="nc">Set</span><span class="o">&lt;?&gt;</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Set"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">classify</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;?&gt;</span> <span class="n">lst</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"List"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">classify</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Unknown Collection"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Collection</span><span class="o">&lt;?&gt;[]</span> <span class="n">collections</span> <span class="o">=</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;(),</span>
            <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">BigInteger</span><span class="o">&gt;(),</span>
            <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;().</span><span class="na">values</span><span class="o">()</span>
        <span class="o">};</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">c</span> <span class="o">:</span> <span class="n">collections</span><span class="o">)</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">classify</span><span class="o">(</span><span class="n">c</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>This program prints <code class="language-plaintext highlighter-rouge">Unknown Collection</code> three times, because <strong>the choice of which overloading to invoke is made at compile time</strong>.</p> <p>The selection among overloaded methods is static, while selection among overriden methods is dynamic.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Wine</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"wine"</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SparklingWine</span> <span class="kd">extends</span> <span class="nc">Wine</span> <span class="o">{</span>
    <span class="nd">@Override</span> <span class="nc">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"sparkling wine"</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Champagne</span> <span class="kd">extends</span> <span class="nc">SparklingWine</span> <span class="o">{</span>
    <span class="nd">@Override</span> <span class="nc">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="s">"champagne"</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Overriding</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Wine</span><span class="o">&gt;</span> <span class="n">wineList</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
            <span class="k">new</span> <span class="nf">Wine</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">SparklingWine</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Champagne</span><span class="o">());</span>

        <span class="k">for</span> <span class="o">(</span><span class="nc">Wine</span> <span class="n">wine</span> <span class="o">:</span> <span class="n">wineList</span><span class="o">)</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">wine</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Avoid confusing choices of overloading.</p> <p>A safe, conservative policy is never to export two overloading with the same number of parameters. You can always give methods different names instead of overloading them.</p> <p>Do not overload methods to take different functional interfaces in the same argument position.</p> <h3 id="use-varargs-judiciously"> <a href="#use-varargs-judiciously" class="anchor-heading" aria-labelledby="use-varargs-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use <em>varargs</em> judiciously </h3> <p>Simple use of varargs</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">sum</span><span class="o">(</span><span class="kt">int</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">arg</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>The <strong>wrong</strong> way to use varargs to pass one or more arguments. This program will fail at runtime instead of failing at compile time.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">min</span><span class="o">(</span><span class="kt">int</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Too few arguments"</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">min</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">min</span><span class="o">)</span>
            <span class="n">min</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
    <span class="k">return</span> <span class="n">min</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>The right way to use varargs to pass one or more arguments</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kt">int</span> <span class="nf">min</span><span class="o">(</span><span class="kt">int</span> <span class="n">firstArg</span><span class="o">,</span> <span class="kt">int</span><span class="o">...</span> <span class="n">remainingArgs</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">min</span> <span class="o">=</span> <span class="n">firstArg</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">remainingArgs</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">arg</span> <span class="o">&lt;</span> <span class="n">min</span><span class="o">)</span>
            <span class="n">min</span> <span class="o">=</span> <span class="n">arg</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">min</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>Exercise care when using varargs in performance-critical situations. Every invocation of a varargs method causes an array allocation and initialisation.</p> <p>For these situations you can determine that 95% of the calls to a method have three or fewer parameters</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">(</span><span class="kt">int</span> <span class="n">a1</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">(</span><span class="kt">int</span> <span class="n">a1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">(</span><span class="kt">int</span> <span class="n">a1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">(</span><span class="kt">int</span> <span class="n">a1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="o">,</span> <span class="kt">int</span><span class="o">...</span> <span class="n">rest</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div></div> <h3 id="return-empty-collections-or-arrays-not-nulls"> <a href="#return-empty-collections-or-arrays-not-nulls" class="anchor-heading" aria-labelledby="return-empty-collections-or-arrays-not-nulls"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Return empty collections or arrays, not nulls </h3> <p>Returns null to indicate an empty collection. <strong>Don’t do this</strong>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cheese</span><span class="o">&gt;</span> <span class="n">cheesesInStock</span> <span class="o">=</span> <span class="o">...;</span>

<span class="cm">/**
 * @return a list containing all of the cheeses in the shop,
 *     or null if no cheeses are available for purchase.
 */</span>
<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cheese</span><span class="o">&gt;</span> <span class="nf">getCheeses</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">cheesesInStock</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">?</span> <span class="kc">null</span>
        <span class="o">:</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">cheesesInStock</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>There is no reason to special-case the situation where the no cheeses are available for purchase. Doing so requires extra code in the client to handle the possibly null return value</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cheese</span><span class="o">&gt;</span> <span class="n">cheeses</span> <span class="o">=</span> <span class="n">shop</span><span class="o">.</span><span class="na">getCheeses</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">cheeses</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">cheeses</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="nc">Cheese</span><span class="o">.</span><span class="na">STILTON</span><span class="o">))</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Jolly good, just the thing."</span><span class="o">);</span>
</code></pre></div></div> <p>The right way to return a possibly empty collection</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cheese</span><span class="o">&gt;</span> <span class="nf">getCheeses</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">cheesesInStock</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Optimisation, avoid allocating empty collections</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cheese</span><span class="o">&gt;</span> <span class="nf">getCheeses</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">cheesesInStock</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">?</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyList</span><span class="o">()</span>
        <span class="o">:</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">cheesesInStock</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>The right way to return a possibly empty array</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Cheese</span><span class="o">[]</span> <span class="nf">getCheeses</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">cheesesInStock</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">Cheese</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Optimisation, avoids allocating empty arrays</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Cheese</span><span class="o">[]</span> <span class="no">EMPTY_CHEESE_ARRAY</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cheese</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>

<span class="kd">public</span> <span class="nc">Cheese</span><span class="o">[]</span> <span class="nf">getCheeses</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">cheesesInStock</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="no">EMPTY_CHEESE_ARRAY</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Never return <code class="language-plaintext highlighter-rouge">null</code> in place for an empty array or collection.</strong></p> <h3 id="return-optionals-judiciously"> <a href="#return-optionals-judiciously" class="anchor-heading" aria-labelledby="return-optionals-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Return optionals judiciously </h3> <p>Optionals are similar in spirit to checked exceptions. You should declare a method to return <code class="language-plaintext highlighter-rouge">Optional&lt;T&gt;</code> if it might not be able to return a result and clients will have to perform special processing if no result is returned.</p> <p>Container types, including collections, maps, streams, arrays and optionals should not be wrapped in optionals. Rather than returning an empty <code class="language-plaintext highlighter-rouge">Optional&lt;List&lt;T&gt;&gt;</code>, you should simply return an empty <code class="language-plaintext highlighter-rouge">List&lt;T&gt;</code>.</p> <p>Returning an optional that contains a boxed primitive is prohibitively expensive as it has two levels of boxing instead of zero. Library designers saw fit to provide analogues of Optional<T> for primitive types `int`, `long` and `double` (`OptionalInt`, `OptionalLong` and `OptionalDouble`). **You should never return an optional of a boxed primitive type.**</T></p> <p>It is almost never appropriate to use an optional as a key, value, or element in a collection array.</p> <p>Often storing an optional in an instance field is a “bad smell”, but sometimes may be justified.</p> <h3 id="write-doc-comments-for-all-exposed-api-elements"> <a href="#write-doc-comments-for-all-exposed-api-elements" class="anchor-heading" aria-labelledby="write-doc-comments-for-all-exposed-api-elements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Write doc comments for all exposed API elements </h3> <p>To document your API properly, you must precede every exported class, interface, constructor, method, and field declaration with a doc comments.</p> <p>The doc comment for a method should describe succinctly the contract between the method and its client.</p> <p>Doc comments should be readable both in the source code and in the generated documentation.</p> <p>No two members or constructors in a class or interface should have the same summary description.</p> <p>When documenting a generic type or method, be sure to document all type parameters.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * An object that maps keys to values.  A map cannot contain
 * duplicate keys; each key can map to at most one value.
 *
 * (Remainder omitted)
 *
 * @param &lt;K&gt; the type of keys maintained by this map
 * @param &lt;V&gt; the type of mapped values
 */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">V</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div> <p>When documenting an enum type, be sure to document the constants.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * An instrument section of a symphony orchestra.
 */</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">OrchestraSection</span> <span class="o">{</span>
    <span class="cm">/** Woodwinds, such as flute, clarinet, and oboe. */</span>
    <span class="no">WOODWIND</span><span class="o">,</span>

    <span class="cm">/** Brass instruments, such as french horn and trumpet. */</span>
    <span class="no">BRASS</span><span class="o">,</span>

    <span class="cm">/** Percussion instruments, such as timpani and cymbals. */</span>
    <span class="no">PERCUSSION</span><span class="o">,</span>

    <span class="cm">/** Stringed instruments, such as violin and cello. */</span>
    <span class="no">STRING</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>When documenting an annotation type, be sure to document any members as the type itself.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Indicates that the annotated method is a test method that
 * must throw the designated exception to pass.
 */</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">ExceptionTest</span> <span class="o">{</span>
     <span class="cm">/**
      * The exception that the annotated test method must throw
      * in order to pass. (The test is permitted to throw any
      * subtype of the type described by this class object.)
      */</span>
    <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Throwable</span><span class="o">&gt;</span> <span class="nf">value</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>Whether or not a class or static method is thread-safe, you should document its thread-safely level.</p> <p>The generated documentation should provide a clear description of your API. The only way to know for sure is to read the web pages generated by the Javadoc utility.</p> <h2 id="general-programming"> <a href="#general-programming" class="anchor-heading" aria-labelledby="general-programming"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> General programming </h2> <h3 id="minimise-the-scope-of-local-variables"> <a href="#minimise-the-scope-of-local-variables" class="anchor-heading" aria-labelledby="minimise-the-scope-of-local-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Minimise the scope of local variables </h3> <p>By minimising the scope of local variables, you increase the readability and maintainability of your code and reduce the likelihood for error.</p> <p><strong>The most powerful technique for minimising the scope of a local variable is to declare it where it is first used.</strong></p> <p>Nearly every local variable declaration should contain an initialiser.</p> <p>Prefer <code class="language-plaintext highlighter-rouge">for</code> loops to <code class="language-plaintext highlighter-rouge">while</code> loops, as <code class="language-plaintext highlighter-rouge">for</code> loops limit the scope of the variables defined in their bodies.</p> <p>Idiom for iterating when you need the iterator</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Element</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span> <span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span> <span class="o">)</span> <span class="o">{</span>
    <span class="nc">Element</span> <span class="n">e</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">...</span> <span class="c1">// Do something with e and i</span>
<span class="o">}</span>
</code></pre></div></div> <p>A final technique to minimise the scope of local variables is to keep methods small and focused.</p> <h3 id="prefer-for-each-loops-to-traditional-for-loops"> <a href="#prefer-for-each-loops-to-traditional-for-loops" class="anchor-heading" aria-labelledby="prefer-for-each-loops-to-traditional-for-loops"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer <code class="language-plaintext highlighter-rouge">for-each</code> loops to traditional <code class="language-plaintext highlighter-rouge">for</code> loops </h3> <p>Not the best way to iterate over a collection</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">Element</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span> <span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span> <span class="o">)</span> <span class="o">{</span>
    <span class="nc">Element</span> <span class="n">e</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
    <span class="o">...</span> <span class="c1">// Do something with e</span>
<span class="o">}</span>
</code></pre></div></div> <p>Not the best way to iterate over an array</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="o">...</span> <span class="c1">// Do something with a[i]</span>
<span class="o">}</span>
</code></pre></div></div> <p>The iterator and the index variables are just clutter, all you need are the elements. They also represent opportunities for error. Also the two loops are quite different.</p> <p>The preferred idiom for iterating over collections and arrays</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="nc">Element</span> <span class="n">e</span> <span class="o">:</span> <span class="n">elements</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span> <span class="c1">// Do something with e</span>
<span class="o">}</span>
</code></pre></div></div> <p>Unfortunately, there are three common situations where you <em>can’t</em> use for-each:</p> <ul> <li>Destructive filtering</li> <li>Transforming</li> <li>Parallel iteration</li> </ul> <p>In these cases you’ll have to use an ordinary <code class="language-plaintext highlighter-rouge">for</code> loop and be wary of the problems they can generate.</p> <h3 id="know-and-use-the-libraries"> <a href="#know-and-use-the-libraries" class="anchor-heading" aria-labelledby="know-and-use-the-libraries"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Know and use the libraries </h3> <p>Don’t reinvent the wheel. If you need to do something that seems like it should be reasonably common, there may be already a facility in the libraries that does what you want.</p> <p>By using a standard library, you take advantage of the knowledge of the experts who wrote it and the experience of those who used it before you.</p> <p>The random number generator of choice is <code class="language-plaintext highlighter-rouge">ThreadLocalRandom</code>, it produces higher quality random numbers, and it’s very fast.</p> <p>Numerous features are added to the libraries in every major release, and it pays to keep abreast of these additions.</p> <p>Every programer should be familiar with the basic of <code class="language-plaintext highlighter-rouge">java.lang</code>, <code class="language-plaintext highlighter-rouge">java.util</code> and <code class="language-plaintext highlighter-rouge">java.io</code> and their subpackages.</p> <h3 id="avoid-float-and-double-if-exact-answers-are-required"> <a href="#avoid-float-and-double-if-exact-answers-are-required" class="anchor-heading" aria-labelledby="avoid-float-and-double-if-exact-answers-are-required"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Avoid <code class="language-plaintext highlighter-rouge">float</code> and <code class="language-plaintext highlighter-rouge">double</code> if exact answers are required </h3> <p>The <code class="language-plaintext highlighter-rouge">float</code> and <code class="language-plaintext highlighter-rouge">double</code> types are particularly ill-suited for monetary calculations because it is impossible to represent 0.1 as a <code class="language-plaintext highlighter-rouge">float</code> or <code class="language-plaintext highlighter-rouge">double</code> exactly.</p> <p>Use <code class="language-plaintext highlighter-rouge">BigDecimal</code>, <code class="language-plaintext highlighter-rouge">int</code> or <code class="language-plaintext highlighter-rouge">long</code> for monetary calculations.</p> <h3 id="prefer-primitive-types-to-boxed-primitives"> <a href="#prefer-primitive-types-to-boxed-primitives" class="anchor-heading" aria-labelledby="prefer-primitive-types-to-boxed-primitives"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer primitive types to boxed primitives </h3> <p>Applying the <code class="language-plaintext highlighter-rouge">==</code> operator to boxed primitives is almost always wrong.</p> <p>When you mix primitives and boxed primitives in an operation, the boxed primitive is auto-unboxed.</p> <p>Autoboxing reduces the verbosity, but not the danger, of using boxed primitives. When your program does unboxing, it can throw a <code class="language-plaintext highlighter-rouge">NullPointerException</code>.</p> <h3 id="avoid-strings-where-other-types-are-more-appropriate"> <a href="#avoid-strings-where-other-types-are-more-appropriate" class="anchor-heading" aria-labelledby="avoid-strings-where-other-types-are-more-appropriate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Avoid strings where other types are more appropriate </h3> <ul> <li>Strings are poor substitutes for other value types.</li> <li>Strings are poor substitutes for enum types.</li> <li>Strings are poor for aggregate types. <code class="language-plaintext highlighter-rouge">String compoundKey = className + "#" + i.next()</code>. If the character used to separate fields occurs in one the fields, chaos may result. To access individual fields you’ll need to provide parsers. You can’t provide <code class="language-plaintext highlighter-rouge">equals</code>, <code class="language-plaintext highlighter-rouge">toString</code> or <code class="language-plaintext highlighter-rouge">compareTo</code>. A better approach is to write a class.</li> <li>String are poor substitutes for capabilities. If a string represent a shared global namespace for a resource, two clients may independently and unintentionally use the same string causing both of them to fail. A better approach is to define an unforgeable key (or capability) to access to resources.</li> </ul> <h3 id="beware-the-performance-of-string-concatenation"> <a href="#beware-the-performance-of-string-concatenation" class="anchor-heading" aria-labelledby="beware-the-performance-of-string-concatenation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Beware the performance of string concatenation </h3> <p>Using the string concatenation repeatedly to concatenate <em>n</em> strings requires time quadratic in <em>n</em>.</p> <p>Performs poorly</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">statement</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numItems</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">lineForItem</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>  <span class="c1">// String concatenation</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>To achieve acceptable performance, use <code class="language-plaintext highlighter-rouge">StringBuilder</code> in place of a <code class="language-plaintext highlighter-rouge">String</code></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">statement</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">StringBuilder</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="n">numItems</span><span class="o">()</span> <span class="o">*</span> <span class="no">LINE_WIDTH</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numItems</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span>
        <span class="n">b</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">lineForItem</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>Don’t use the string concatenation operator to combine more than a few strings.</strong></p> <h3 id="refer-to-objects-by-their-interfaces"> <a href="#refer-to-objects-by-their-interfaces" class="anchor-heading" aria-labelledby="refer-to-objects-by-their-interfaces"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Refer to objects by their interfaces </h3> <p>If appropriate interface exists, then parameters, return values, variables, and field should all be declared using interface types.</p> <p>Good, it uses interface as type</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Son</span><span class="o">&gt;</span> <span class="n">sonSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;&gt;();</span>
</code></pre></div></div> <p>Bad, it uses class as type</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LinkedHashSet</span><span class="o">&lt;</span><span class="nc">Son</span><span class="o">&gt;</span> <span class="n">sonSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedHashSet</span><span class="o">&lt;&gt;();</span>
</code></pre></div></div> <p><strong>If you get into the habit of using interfaces as types, your program will be much more flexible.</strong> If you decide to switch implementations, all you have to do is change the class name in the constructor.</p> <p>It is entirely appropriate to refer to an object by a class rather than an interface if no appropriate interface exists.</p> <p>When there is no appropriate interface, just use the least specific class int he class hierarchy that provides the required functionality.</p> <h3 id="prefer-interfaces-to-reflection"> <a href="#prefer-interfaces-to-reflection" class="anchor-heading" aria-labelledby="prefer-interfaces-to-reflection"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer interfaces to reflection </h3> <p>Reflection allows one class to use another, even if the latter class did not exist when the former was compiled. This comes at a price:</p> <ul> <li>You lose all the benefits of compile-type type checking.</li> <li>The code required to perform reflective access is clumsy and verbose.</li> <li>Performance suffers.</li> </ul> <p>You can obtain many of the benefits of reflection while incurring few of its costs by using it in a very limited form. Create instances reflectively and access them normally via their interface or superclass.</p> <p>Reflective instantiation with interface access.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Translate the class name into a Class object</span>
    <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">cl</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;)</span>  <span class="c1">// Unchecked cast!</span>
                <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">fatalError</span><span class="o">(</span><span class="s">"Class not found."</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Get the constructor</span>
    <span class="nc">Constructor</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">cons</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">cons</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">NoSuchMethodException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">fatalError</span><span class="o">(</span><span class="s">"No parameterless constructor"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Instantiate the set</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cons</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">fatalError</span><span class="o">(</span><span class="s">"Constructor not accessible"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InstantiationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">fatalError</span><span class="o">(</span><span class="s">"Class not instantiable."</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InvocationTargetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">fatalError</span><span class="o">(</span><span class="s">"Constructor threw "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassCastException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">fatalError</span><span class="o">(</span><span class="s">"Class doesn't implement Set"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Exercise the set</span>
    <span class="n">s</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">args</span><span class="o">).</span><span class="na">subList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">fatalError</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="use-native-methods-judiciously"> <a href="#use-native-methods-judiciously" class="anchor-heading" aria-labelledby="use-native-methods-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use native methods judiciously </h3> <p>The Java Native Interface (JNI) allows Java programs to call <em>native methods</em> written in <em>native programming languages</em> such as C or C++.</p> <p>It is rarely advisable to use native methods for improved performance.</p> <h3 id="optimise-judiciously"> <a href="#optimise-judiciously" class="anchor-heading" aria-labelledby="optimise-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Optimise judiciously </h3> <p>Strive to write good programs rather than fast ones.</p> <p>Strive to avoid design decisions that limit performance.</p> <p>Consider the performance consequences of your API design decisions.</p> <p>It is a very bad idea to warp an API to achieve good performance. The performance issue that caused you to warp the API may go away in a future.</p> <p>Measure performance before and after each attempted optimisation.</p> <h3 id="adhere-to-generally-accepted-naming-conventions"> <a href="#adhere-to-generally-accepted-naming-conventions" class="anchor-heading" aria-labelledby="adhere-to-generally-accepted-naming-conventions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adhere to generally accepted naming conventions </h3> <p>Package and module names should be hierarchical, with components separated by periods. Alphabetic characters, rarely digits.</p> <p>Components should be short, meaningful abbreviations or acronyms.</p> <p>Class and interface names, including enum and annotation type names, should consist of one or more words, with the first letter of each word capitalised. Abbreviations should be avoided. If you use acronyms, capitalise just the first letter. Better to have <code class="language-plaintext highlighter-rouge">HttpUrl</code> than <code class="language-plaintext highlighter-rouge">HTTPURL</code>.</p> <p>Method and field names follow the same conventions as before, except that first letter should be lowercase.</p> <p>Constant fields should consist of one or more upper case words separated by the underscore character.</p> <p>Local variable names have similar conventions to member names, except that abbreviations are permitted.</p> <p>Type parameters consist of a single letter. <code class="language-plaintext highlighter-rouge">T</code> for arbitrary type <code class="language-plaintext highlighter-rouge">E</code> for element type, <code class="language-plaintext highlighter-rouge">K</code> and <code class="language-plaintext highlighter-rouge">V</code> for key and value types of a map, and <code class="language-plaintext highlighter-rouge">X</code> for exception. Return type is usually <code class="language-plaintext highlighter-rouge">R</code>. A sequence of arbitrary types can be <code class="language-plaintext highlighter-rouge">T</code>, <code class="language-plaintext highlighter-rouge">U</code>, <code class="language-plaintext highlighter-rouge">V</code> or <code class="language-plaintext highlighter-rouge">T1</code>, <code class="language-plaintext highlighter-rouge">T2</code>, <code class="language-plaintext highlighter-rouge">T3</code>.</p> <p>Instantiable classes, including enum types are generally named with a singular noun or noun phrase.</p> <p>Non instantiable utility classes are often named with a plural noun or with an adjective ending in <code class="language-plaintext highlighter-rouge">able</code> or <code class="language-plaintext highlighter-rouge">ible</code>. In case of annotations, nouns, verbs, prepositions and adjectives are all common.</p> <p>Methods that perform some action are generally named with a verb or verb phrase. Methods that return a <code class="language-plaintext highlighter-rouge">boolean</code> value usually have names that begin with the word <code class="language-plaintext highlighter-rouge">is</code> or <code class="language-plaintext highlighter-rouge">has</code> followed by a noun, noun phrase that functions as an adjective.</p> <p>Method that return non-<code class="language-plaintext highlighter-rouge">boolean</code> attribute of the object are usually named with a noun, a noun phrase or a verb phrase beginning with the verb <code class="language-plaintext highlighter-rouge">get</code>, although nowadays might not be necessary.</p> <p>Instance methods that convert the type of a n object, are often called <code class="language-plaintext highlighter-rouge">to</code><em><code class="language-plaintext highlighter-rouge">Type</code></em>. Methods that return a view whose type differs from that of receiving object are often called as <code class="language-plaintext highlighter-rouge">as</code><em>Type</em>. Methods that return a primitive with the same value as the object on which they’re invoked are often called <em>type</em><code class="language-plaintext highlighter-rouge">Value</code>.</p> <p>Fields of type <code class="language-plaintext highlighter-rouge">boolean</code> are often named like <code class="language-plaintext highlighter-rouge">boolean</code> accessor methods with the initial <code class="language-plaintext highlighter-rouge">is</code> omitted. Fields of other types are usually named with nouns or noun phrases.</p> <h2 id="exceptions"> <a href="#exceptions" class="anchor-heading" aria-labelledby="exceptions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exceptions </h2> <h3 id="use-exceptions-for-exceptional-conditions"> <a href="#use-exceptions-for-exceptional-conditions" class="anchor-heading" aria-labelledby="use-exceptions-for-exceptional-conditions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use exceptions for exceptional conditions </h3> <p>Horrible abuse of exceptions</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="n">range</span><span class="o">[</span><span class="n">i</span><span class="o">++].</span><span class="na">climb</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ArrayIndexOutOfBoundsException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li>Exception processing is slow</li> <li>Placing code into a <code class="language-plaintext highlighter-rouge">try-catch</code> block inhibits some optimisations the JVM perform</li> </ul> <p>Exceptions should never be used for ordinary control flow.</p> <p>A well-designed API must not force its clients to use exceptions for ordinary control flow.</p> <h3 id="use-checked-exceptions-for-recoverable-conditions-and-runtime-exceptions-for-programming-errors"> <a href="#use-checked-exceptions-for-recoverable-conditions-and-runtime-exceptions-for-programming-errors" class="anchor-heading" aria-labelledby="use-checked-exceptions-for-recoverable-conditions-and-runtime-exceptions-for-programming-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use checked exceptions for recoverable conditions and runtime exceptions for programming errors </h3> <p>Use checked exceptions for conditions from which the caller can reasonably be expected to recover.</p> <p>Use runtime exceptions to indicate programming errors. <em>Precondition violations</em> or the failure by the client of an API to adhere to the contract established by the API specification.</p> <p><code class="language-plaintext highlighter-rouge">Error</code> exceptions are usually intended for the JVM to indicate conditions that make it impossible to continue execution. Therefore <strong>all of the unchecked throwables you implement should subclass <code class="language-plaintext highlighter-rouge">RuntimeException</code>.</strong> You shouldn’t throw <code class="language-plaintext highlighter-rouge">Error</code> exceptions either.</p> <p>Exceptions are full-fledged objects, define methods to provide additional information concerning the condition that caused the exception. This is crucial for checked exceptions.</p> <h3 id="avoid-unnecessary-use-of-checked-exceptions"> <a href="#avoid-unnecessary-use-of-checked-exceptions" class="anchor-heading" aria-labelledby="avoid-unnecessary-use-of-checked-exceptions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Avoid unnecessary use of checked exceptions </h3> <p>Checked exceptions <em>force</em> programmers to deal with problems. Overuse of checked exceptions can make them far less pleasant to use.</p> <h3 id="favour-the-use-of-standard-exceptions"> <a href="#favour-the-use-of-standard-exceptions" class="anchor-heading" aria-labelledby="favour-the-use-of-standard-exceptions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Favour the use of standard exceptions </h3> <p>Do not reuse <code class="language-plaintext highlighter-rouge">Exception</code>, <code class="language-plaintext highlighter-rouge">RuntimeException</code>, <code class="language-plaintext highlighter-rouge">Throwable</code> or <code class="language-plaintext highlighter-rouge">Error</code> directly.</p> <p>Most commonly reused exceptions</p> <div class="table-wrapper"><table> <thead> <tr> <th>Exception</th> <th>Occasion for use</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">IllegalArgumentException</code></td> <td>Non-null parameter value is inappropriate</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">IllegalStateException</code></td> <td>Object state is inappropriate for method invocation</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">NullPointerException</code></td> <td>Parameter value is null where prohibited</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">IndexOutOfBoundsException</code></td> <td>Index parameter value is out of range</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">ConcurrentModificationException</code></td> <td>Concurrent modification of an object has been detected where it is prohibited</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">UnsupportedOperationException</code></td> <td>Object does not support method</td> </tr> </tbody> </table></div> <p>Throw <code class="language-plaintext highlighter-rouge">IllegalStateException</code> if no argument values would have worked, otherwise throw <code class="language-plaintext highlighter-rouge">IllegalArgumentException</code>.</p> <h3 id="throw-exceptions-appropriate-to-the-abstraction"> <a href="#throw-exceptions-appropriate-to-the-abstraction" class="anchor-heading" aria-labelledby="throw-exceptions-appropriate-to-the-abstraction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Throw exceptions appropriate to the abstraction </h3> <p>Higher layers should catch lower-level exceptions and, in their place, throw exceptions that can be explained in terms of the higher-level abstraction.</p> <p>Exception translations</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
   <span class="o">...</span> <span class="c1">// Use lower-level abstraction to do our bidding</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">LowerLevelException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="nf">HigherLevelException</span><span class="o">(...);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Sometimes the low-level exception might be helpful to someone debugging the higher-level.</p> <p><em>Exception chaining</em></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
    <span class="o">...</span> <span class="c1">// Use lower-level abstraction to do our bidding</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">LowerLevelException</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">HigherLevelException</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>While exception translation is superior to mindless propagation of exceptions from lower layers, it should not be overused. The best way to deal with exceptions from lower layers is to avoid them, by ensuring that lower-level methods succeed. Sometimes you can do this by checking the validity of parameters to be passed to lower level abstractions.</p> <h3 id="document-all-exceptions-thrown-by-each-method"> <a href="#document-all-exceptions-thrown-by-each-method" class="anchor-heading" aria-labelledby="document-all-exceptions-thrown-by-each-method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Document all exceptions thrown by each method </h3> <p>Always declare checked exceptions individually, and document precisely the conditions under which each one is thrown.</p> <p>Use the Javadoc <code class="language-plaintext highlighter-rouge">@throws</code> tag to document each exception that a method can throw, but do not use the <code class="language-plaintext highlighter-rouge">throws</code> keyword on unchecked exceptions.</p> <p>If an exception is thrown by many methods in a class for the same reason, you can document the exception in the class’s documentation comment.</p> <h3 id="include-failure-capture-information-in-detail-messages"> <a href="#include-failure-capture-information-in-detail-messages" class="anchor-heading" aria-labelledby="include-failure-capture-information-in-detail-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Include failure-capture information in detail messages </h3> <p><strong>To capture a failure, the detail message of an exception should contain the values of all parameters and fields that contributed to the exception.</strong> For example <code class="language-plaintext highlighter-rouge">IndexOutOfBoundsException</code> should contain the lower bound, the upper bound, and the index value that failed.</p> <p>Do not include passwords, encryption keys, and the like in detail messages as stack traces may be seen by many people diagnosing and fixing software issues.</p> <p>One way to ensure that exceptions contain adequate failure-capture information in their detail messages is to require this information in their constructors.</p> <h3 id="strive-for-failure-atomicity"> <a href="#strive-for-failure-atomicity" class="anchor-heading" aria-labelledby="strive-for-failure-atomicity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strive for failure atomicity </h3> <p>Generally speaking, a failed method invocation should leave the object in the state that it was in prior the invocation.</p> <p>The simplest way is to design immutable objects, where failure atomicity is free.</p> <p>For methods that operate on mutable objects, the most common way to achieve failure atomicity is to check parameters for validity before performing the operation.</p> <h3 id="dont-ignore-exceptions"> <a href="#dont-ignore-exceptions" class="anchor-heading" aria-labelledby="dont-ignore-exceptions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Don’t ignore exceptions </h3> <p>An empty <code class="language-plaintext highlighter-rouge">catch</code> block defeats the purpose of exceptions.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SomeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div> <p>If you choose to ignore an exception, the <code class="language-plaintext highlighter-rouge">catch</code> block should contain a comment explaining why it is appropriate to do so and the variable should be named <code class="language-plaintext highlighter-rouge">ignored</code>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="n">exec</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="nl">planarMap:</span><span class="o">:</span><span class="n">chromaticNumber</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">numColors</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span> <span class="c1">// Default; guaranteed sufficient for any map</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">numColors</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">TimeoutException</span> <span class="o">|</span> <span class="nc">ExecutionException</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Use default: minimal coloring is desirable, not required</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="concurrency"> <a href="#concurrency" class="anchor-heading" aria-labelledby="concurrency"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Concurrency </h2> <h3 id="synchronise-access-to-shared-mutable-data"> <a href="#synchronise-access-to-shared-mutable-data" class="anchor-heading" aria-labelledby="synchronise-access-to-shared-mutable-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Synchronise access to shared mutable data </h3> <p>Synchronisation is required for reliable communication between threads as well as for mutual exclusion.</p> <p>Do not use <code class="language-plaintext highlighter-rouge">Thread.stop</code> as it is inherently <em>unsafe</em>, its use can result in data corruption.</p> <p>Broken</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StopThread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">stopRequested</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">backgroundThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(!</span><span class="n">stopRequested</span><span class="o">)</span>
                <span class="n">i</span><span class="o">++;</span>
        <span class="o">});</span>
        <span class="n">backgroundThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">stopRequested</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Properly synchronised cooperative thread termination</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StopThread</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">stopRequested</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">requestStop</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">stopRequested</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">stopRequested</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stopRequested</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">Thread</span> <span class="n">backgroundThread</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">(!</span><span class="n">stopRequested</span><span class="o">())</span>
                <span class="n">i</span><span class="o">++;</span>
        <span class="o">});</span>
        <span class="n">backgroundThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">requestStop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Synchronisation is not guaranteed to work unless both read and write operations are synchronised.</p> <p>Either share immutable data, or don’t share at all. Confine mutable data into a single thread.</p> <p>When multiple threads share mutable data, each thread that reads or writes the data must perform synchronisation.</p> <h3 id="avoid-excessive-synchronisation"> <a href="#avoid-excessive-synchronisation" class="anchor-heading" aria-labelledby="avoid-excessive-synchronisation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Avoid excessive synchronisation </h3> <p>To avoid liveness and safety failures, never cede control to the client within a synchronised method or block. Inside a synchronised region, do not invoke a method that is designed to be overridden, or one provided by a client in the form a function object.</p> <p>As a rule, you should do as little work as possible inside synchronised regions.</p> <h3 id="prefer-executors-tasks-and-streams-to-threads"> <a href="#prefer-executors-tasks-and-streams-to-threads" class="anchor-heading" aria-labelledby="prefer-executors-tasks-and-streams-to-threads"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer executors, tasks, and streams to threads </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ExecutorService</span> <span class="n">exec</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">exec</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">runnable</span><span class="o">);</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">exec</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></div></div> <p>You should refrain from working directly with threads, a <code class="language-plaintext highlighter-rouge">Thread</code> serves as both a unit of work and the mechanism for executing it. In the executor framework, the unit of work and the execution are separate.</p> <h3 id="prefer-concurrency-utilities-to-wait-and-notify"> <a href="#prefer-concurrency-utilities-to-wait-and-notify" class="anchor-heading" aria-labelledby="prefer-concurrency-utilities-to-wait-and-notify"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer concurrency utilities to <code class="language-plaintext highlighter-rouge">wait</code> and <code class="language-plaintext highlighter-rouge">notify</code> </h3> <p>Given the difficulty of using <code class="language-plaintext highlighter-rouge">wait</code> and <code class="language-plaintext highlighter-rouge">notify</code> correctly, you should use the higher-level concurrency utilities instead.</p> <p>It is impossible to exclude concurrent activity from a concurrent collection; locking it will only slow the program.</p> <p>Use <code class="language-plaintext highlighter-rouge">ConcurrentHashMap</code> in preference to <code class="language-plaintext highlighter-rouge">Collections.synchronizedMap</code>. Doing so can dramatically increase the performance of concurrent applications.</p> <p>For interval timing, always use <code class="language-plaintext highlighter-rouge">System.nanoTime</code> rather than <code class="language-plaintext highlighter-rouge">System.currentTimeMillis</code>. <code class="language-plaintext highlighter-rouge">System.nanoTime</code> is more accurate and is unaffected by adjustments to the system’s real-time clock.</p> <p>The standard idiom for using <code class="language-plaintext highlighter-rouge">wait</code> method</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">synchronized</span> <span class="o">(</span><span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(&lt;</span><span class="n">condition</span> <span class="n">does</span> <span class="n">not</span> <span class="n">hold</span><span class="o">&gt;)</span>
        <span class="n">obj</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span> <span class="c1">// (Releases lock, and reacquires on wakeup)</span>
    <span class="o">...</span> <span class="c1">// Perform action appropriate to condition</span>
<span class="o">}</span>
</code></pre></div></div> <p>Always use the wait loop idiom to invoke the <code class="language-plaintext highlighter-rouge">wait</code> method; never invoke it outside of a loop. The loop serves to test the condition before and after waiting.</p> <p>There is seldom, if ever, a reason to use <code class="language-plaintext highlighter-rouge">wait</code> and <code class="language-plaintext highlighter-rouge">notify</code> in new code.</p> <h3 id="document-thread-safety"> <a href="#document-thread-safety" class="anchor-heading" aria-labelledby="document-thread-safety"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Document thread safety </h3> <p>The presence of <code class="language-plaintext highlighter-rouge">synchronized</code> modifier in a method declaration is an implementation detail, not a part of its API.</p> <p>To enable safe concurrent use, a class must clearly document what level of thread safety it supports:</p> <ul> <li><strong>Immutable.</strong> No extra synchronisation is necessary.</li> <li><strong>Unconditionally thread-safe.</strong> Instances are mutable, but clients don’t need to worry about synchronisation.</li> <li><strong>Conditionally thread-safe.</strong> Instances are mutable. Some methods require external synchronisation for safe concurrent use.</li> <li><strong>Not thread-safe.</strong> Instances are mutable, clients must surround each method invocation with external synchronisation.</li> <li><strong>Thread-hostile.</strong> The class is unsafe for concurrent use even if every method invocation is surrounded by external synchronisation.</li> </ul> <p>Lock fields should always be declared <code class="language-plaintext highlighter-rouge">final</code>.</p> <h3 id="use-lazy-evaluation-judiciously"> <a href="#use-lazy-evaluation-judiciously" class="anchor-heading" aria-labelledby="use-lazy-evaluation-judiciously"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use lazy evaluation judiciously </h3> <p>Under most circumstances, normal initialisation is preferable to lazy initialisation.</p> <p>Normal initialisation of an instance field</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">final</span> <span class="nc">FieldType</span> <span class="n">field</span> <span class="o">=</span> <span class="n">computeFieldValue</span><span class="o">();</span>
</code></pre></div></div> <p>If you use lazy initialisation to break an initialisation circularity, use a synchronised accessor.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">FieldType</span> <span class="n">field</span><span class="o">;</span>

<span class="kd">private</span> <span class="kd">synchronized</span> <span class="nc">FieldType</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">field</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">computeFieldValue</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">field</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>If you need to use lazy initialisation for performance on a static field, use the lazy initialisation holder class idiom.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FieldHolder</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">FieldType</span> <span class="n">field</span> <span class="o">=</span> <span class="n">computeFieldValue</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="nc">FieldType</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="nc">FieldHolder</span><span class="o">.</span><span class="na">field</span><span class="o">;</span> <span class="o">}</span>
</code></pre></div></div> <p>If you need to use lazy initialisation for performance on an instance field, use the double-check idiom.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">volatile</span> <span class="nc">FieldType</span> <span class="n">field</span><span class="o">;</span>

<span class="kd">private</span> <span class="nc">FieldType</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">FieldType</span> <span class="n">result</span> <span class="o">=</span> <span class="n">field</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// First check (no locking)</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">field</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>  <span class="c1">// Second check (with locking)</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">computeFieldValue</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="dont-depend-on-thread-scheduler"> <a href="#dont-depend-on-thread-scheduler" class="anchor-heading" aria-labelledby="dont-depend-on-thread-scheduler"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Don’t depend on thread scheduler </h3> <p>Any program that relies on the thread scheduler for correctness or performance is likely to be nonportable.</p> <p>Threads should not run if they aren’t doing useful work.</p> <p>Awful <code class="language-plaintext highlighter-rouge">CountDownLatch</code> implementation, busy-waits incessantly.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SlowCountDownLatch</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SlowCountDownLatch</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">count</span> <span class="o">+</span> <span class="s">" &lt; 0"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">await</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
                    <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">countDown</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span>
            <span class="n">count</span><span class="o">--;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Resist the temptation to “fix” the program by putting calls to <code class="language-plaintext highlighter-rouge">Thread.yield</code>, it depends a lot on the JVM and it has no testable semantics.</p> <p>Thread semantics are among the least portable features of Java.</p> <h2 id="serialisation"> <a href="#serialisation" class="anchor-heading" aria-labelledby="serialisation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Serialisation </h2> <h3 id="prefer-alternatives-to-java-serialisation"> <a href="#prefer-alternatives-to-java-serialisation" class="anchor-heading" aria-labelledby="prefer-alternatives-to-java-serialisation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prefer alternatives to Java serialisation </h3> <p>The best way to avoid serialisation exploits is never to deserialise anything. There is no reason to use Java serialisation in any new system you write.</p> <p>If you can’t avoid serialisation, your next best alternative is to never deserialise untrusted data.</p> <p>You can use the objet deserialisation filter added in Java 9 <code class="language-plaintext highlighter-rouge">java.io.ObjectInputFilter</code>. Accepting classes by default and rejecting a list of potentially dangerous ones is know as <em>blacklisting</em>; rejecting classes by default and accepting a list of those that are presumed safe is know as <em>whitelisting</em>. <strong>Prefer whitelisting to blacklisting</strong>.</p> <h3 id="implement-serializable-with-great-caution"> <a href="#implement-serializable-with-great-caution" class="anchor-heading" aria-labelledby="implement-serializable-with-great-caution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implement <code class="language-plaintext highlighter-rouge">Serializable</code> with great caution </h3> <p>A major cost of implementing <code class="language-plaintext highlighter-rouge">Serializable</code> is that it decreases the flexibility to change a class’s implementation once it has been released, it’s byte-stream encoding becomes part of its exported API.</p> <p>A second cost of implementing <code class="language-plaintext highlighter-rouge">Serializable</code> is that it increases the likelihood for bugs and security holes.</p> <p>A third cost of implementing <code class="language-plaintext highlighter-rouge">Serializable</code> is that it increases the testing burden associated with releasing a new version of a class. It is important to check that it is possible to serialise an instance in the new release and deserialise it in old releases, and vice versa.</p> <p>Implementing <code class="language-plaintext highlighter-rouge">Serializable</code> is not a decision to be undertake lightly.</p> <p>Classes designed for inheritance should rarely implement <code class="language-plaintext highlighter-rouge">Serializable</code>, and interfaces should rarely extend it. Doing so would place substantial burden on anyone who extends the class or implements the interface.</p> <p>Inner classes should not implement <code class="language-plaintext highlighter-rouge">Serializable</code>. The default serialised form of an inner class is ill-defined precisely because of the <em>enclosed instances</em>. A <em>static member class</em> can however, implement <code class="language-plaintext highlighter-rouge">Serializable</code>.</p> <h3 id="consider-using-a-custom-serialised-form"> <a href="#consider-using-a-custom-serialised-form" class="anchor-heading" aria-labelledby="consider-using-a-custom-serialised-form"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consider using a custom serialised form </h3> <p>Do not accept the default serialised form without first considering whether it is appropriate, you’ll never escape completely from the implementation.</p> <p>The default serialised form is likely to be appropriate if an object’s physical representation is identical to its logical content.</p> <p>A good candidate for default serialised form</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Name</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="cm">/**
     * Last name. Must be non-null.
     * @serial
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

    <span class="cm">/**
     * First name. Must be non-null.
     * @serial
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>
    <span class="cm">/**
     * Middle name, or null if there is none.
     * @serial
     */</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">middleName</span><span class="o">;</span>

    <span class="o">...</span> <span class="c1">// Remainder omitted</span>
<span class="o">}</span>
</code></pre></div></div> <p>Even if you decide that the default serialised form is appropriate, you often must provide a <code class="language-plaintext highlighter-rouge">readObject</code> method to ensure invariants and security.</p> <p>An awful candidate for default serialised form.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">StringList</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Entry</span> <span class="n">head</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">data</span><span class="o">;</span>
        <span class="nc">Entry</span>  <span class="n">next</span><span class="o">;</span>
        <span class="nc">Entry</span>  <span class="n">previous</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">...</span> <span class="c1">// Remainder omitted</span>
<span class="o">}</span>
</code></pre></div></div> <p>Using a default serialised form when an object’s physical representation differs substantially from its logical data content has four advantages.</p> <ul> <li>It permanently ties the exported API to the current internal representation.</li> <li>It can consume excessive space.</li> <li>It can consume excessive time.</li> <li>It can cause stack overflows.</li> </ul> <p><code class="language-plaintext highlighter-rouge">StringList</code> with a reasonable custom serialised form.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">StringList</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">transient</span> <span class="kt">int</span> <span class="n">size</span>   <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">transient</span> <span class="nc">Entry</span> <span class="n">head</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="c1">// No longer Serializable!</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">data</span><span class="o">;</span>
        <span class="nc">Entry</span>  <span class="n">next</span><span class="o">;</span>
        <span class="nc">Entry</span>  <span class="n">previous</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Appends the specified string to the list</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

    <span class="cm">/**
     * Serialize this {@code StringList} instance.
     *
     * @serialData The size of the list (the number of strings
     * it contains) is emitted ({@code int}), followed by all of
     * its elements (each a {@code String}), in the proper
     * sequence.
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">writeObject</span><span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">s</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">s</span><span class="o">.</span><span class="na">defaultWriteObject</span><span class="o">();</span>
        <span class="n">s</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>

        <span class="c1">// Write out all elements in the proper order.</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Entry</span> <span class="n">e</span> <span class="o">=</span> <span class="n">head</span><span class="o">;</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span>
            <span class="n">s</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">data</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">s</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
        <span class="n">s</span><span class="o">.</span><span class="na">defaultReadObject</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">numElements</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>

        <span class="c1">// Read in all elements and insert them in list</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numElements</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">add</span><span class="o">((</span><span class="nc">String</span><span class="o">)</span> <span class="n">s</span><span class="o">.</span><span class="na">readObject</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="o">...</span> <span class="c1">// Remainder omitted</span>
<span class="o">}</span>
</code></pre></div></div> <p>Every instance field that isn’t labeled <code class="language-plaintext highlighter-rouge">transient</code> will be serialised within the <code class="language-plaintext highlighter-rouge">defaultWriteObject</code> method is invoked. Every instance field that can be declared transient, should be. Before deciding to make a field nontransient, convince yourself that its value is part of the logical state of the object.</p> <p>You must impose any synchronisation on object serialisation that you would impose on any other method that reads the entire state of the object.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">writeObject</span><span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">s</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="n">s</span><span class="o">.</span><span class="na">defaultWriteObject</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>Regardless of what serialised form you choose, declare an explicit serial version UID in every serialisable class you write. This eliminates the serial version UID in every serialisable class you write, plus it has some performance benefits.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">randomLongValue</span><span class="o">;</span>
</code></pre></div></div> <p>It doesn’t matter what value you choose.</p> <p>If you ever want to make a new version of a class that is <em>incompatible</em> with existing versions, merely change the value in the serial version UID declaration. Do not change the serial version UID unless you want to break compatibility with all existing serialised instances of a class.</p> <h3 id="write-readobject-methods-defensively"> <a href="#write-readobject-methods-defensively" class="anchor-heading" aria-labelledby="write-readobject-methods-defensively"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Write <code class="language-plaintext highlighter-rouge">readObject</code> methods defensively </h3> <p>When an object is deserialised, it is critical to defensively copy any field containing an object reference that a client must not possess.</p> <p><code class="language-plaintext highlighter-rouge">readObject</code> method with defensive copying and validity checking.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">s</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
    <span class="n">s</span><span class="o">.</span><span class="na">defaultReadObject</span><span class="o">();</span>

    <span class="c1">// Defensively copy our mutable components</span>
    <span class="n">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
    <span class="n">end</span>   <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">end</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>

    <span class="c1">// Check that our invariants are satisfied</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">end</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidObjectException</span><span class="o">(</span><span class="n">start</span> <span class="o">+</span><span class="s">" after "</span><span class="o">+</span> <span class="n">end</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li>For classes with object reference fields that must remain private, defensively copy each object in such a field. Mutable components of immutable classes fall into this category.</li> <li>Check any invariants and throw an <code class="language-plaintext highlighter-rouge">InvalidObjectException</code> if a check fails. The checks should follow any defensive copying.</li> <li>If an entire object graph must be validated after it is deserialised, use the <code class="language-plaintext highlighter-rouge">ObjectInputValidation</code> interface.</li> <li>Do not invoke any overridable methods in the class, directly or indirectly.</li> </ul> <h3 id="for-instance-control-prefer-enum-types-to-readresolve"> <a href="#for-instance-control-prefer-enum-types-to-readresolve" class="anchor-heading" aria-labelledby="for-instance-control-prefer-enum-types-to-readresolve"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> For instance control, prefer enum types to <code class="language-plaintext highlighter-rouge">readResolve</code> </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Elvis</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Elvis</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Elvis</span><span class="o">();</span>

    <span class="kd">private</span> <span class="nf">Elvis</span><span class="o">()</span> <span class="o">{</span>  <span class="o">...</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">readResolve</code> for instance control, you can do better!</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Return the one true Elvis and let the garbage collector</span>
    <span class="c1">// take care of the Elvis impersonator.</span>
    <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>If you depend on <code class="language-plaintext highlighter-rouge">readResolve</code> for instance control, all instance field with object reference types myst be declared <code class="language-plaintext highlighter-rouge">transient</code>. An attacker might secure a reference to the deserialised object before its <code class="language-plaintext highlighter-rouge">readResolve</code> method is run.</p> <p>Broken singleton, has nontransient object reference field.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Elvis</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Elvis</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Elvis</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nf">Elvis</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">favoriteSongs</span> <span class="o">=</span>
        <span class="o">{</span> <span class="s">"Hound Dog"</span><span class="o">,</span> <span class="s">"Heartbreak Hotel"</span> <span class="o">};</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printFavorites</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">favoriteSongs</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Enum singleton, the preferred approach.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Elvis</span> <span class="o">{</span>
    <span class="no">INSTANCE</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">favoriteSongs</span> <span class="o">=</span>
        <span class="o">{</span> <span class="s">"Hound Dog"</span><span class="o">,</span> <span class="s">"Heartbreak Hotel"</span> <span class="o">};</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printFavorites</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">favoriteSongs</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>The accessibility of <code class="language-plaintext highlighter-rouge">readResolve</code> is significant. On final classes, it should be private. On nonfinal class, you must carefully consider its accessibility.</p> <h3 id="consider-serialisation-proxies-instead-of-serialised-instances"> <a href="#consider-serialisation-proxies-instead-of-serialised-instances" class="anchor-heading" aria-labelledby="consider-serialisation-proxies-instead-of-serialised-instances"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Consider serialisation proxies instead of serialised instances </h3> <p>Making classes implement <code class="language-plaintext highlighter-rouge">Serializable</code> increases the likelihood of bugs and security problems as it allows instances to be created using extralinguistic mechanism in place of ordinary constructors. There is a technique that greatly reduces the risks called <em>serialisation proxy pattern</em>.</p> <p>Serialisation proxy for <code class="language-plaintext highlighter-rouge">Period</code> class</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SerializationProxy</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">start</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">end</span><span class="o">;</span>

    <span class="nc">SerializationProxy</span><span class="o">(</span><span class="nc">Period</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">start</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">start</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">end</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">end</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span>
        <span class="mi">234098243823485285L</span><span class="o">;</span> <span class="c1">// Any number will do (Item  87)</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">writeReplace</code> method for the serialisation proxy pattern</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">Object</span> <span class="nf">writeReplace</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">SerializationProxy</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">readObject</code> method for the serialisation proxy pattern</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">stream</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">InvalidObjectException</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidObjectException</span><span class="o">(</span><span class="s">"Proxy required"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">readResolve</code> method for <code class="language-plaintext highlighter-rouge">Period.SerializationProxy</code></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Period</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>    <span class="c1">// Uses public constructor</span>
<span class="o">}</span>
</code></pre></div></div> <p>Consider the serialisation proxy pattern whenever you find yourself having to write a <code class="language-plaintext highlighter-rouge">readObject</code> or <code class="language-plaintext highlighter-rouge">writeObject</code> method on a class not extendable by its clients. This pattern is perhaps the easiest way to robustly serialise object with nontrivial invariants.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
